<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contentHaul xmlns:a="http://www.appian.com/ae/types/2009">
    <versionUuid>_a-0000ec5b-dce3-8000-e69f-01ef9001ef90_10134131</versionUuid>
    <interface>
        <name>SCDO_TraspasoEntreUsuario</name>
        <uuid>_a-0000e9a7-6d42-8000-e63f-01ef9001ef90_5248696</uuid>
        <description>Regla de interfaz para el traspaso de operaciones entre usuarios</description>
        <parentUuid>_a-0000e801-560f-8000-e5d9-01ef9001ef90_1707049</parentUuid>
        <visibility>
            <advertise>false</advertise>
            <hierarchy>true</hierarchy>
            <indexable>true</indexable>
            <quota>false</quota>
            <searchable>true</searchable>
            <system>false</system>
            <unlogged>false</unlogged>
        </visibility>
        <definition>a!localVariables(
  
  local!ejecutivos: #"4abb2c14-ac25-4b4a-a0f6-a11f52071c0b"(idacceso: null),
  local!nombreActual:if(a!isNotNullOrEmpty(index(#"4abb2c14-ac25-4b4a-a0f6-a11f52071c0b"(usuarioopics: ri!reporte.usuario),"data",null)),
  index(#"4abb2c14-ac25-4b4a-a0f6-a11f52071c0b"(usuarioopics: ri!reporte.usuario, paginInfo: #"SYSTEM_SYSRULES_pagingInfo"(startIndex: 1, batchSize: 1)),"data","nombre",null),null
  ) ,
  local!usuarioActual: ri!reporte.usuario,
  local!usuario,
  local!id_ejecutivo,
  
  #"SYSTEM_SYSRULES_cardLayout"(
    contents: {
      #"SYSTEM_SYSRULES_richTextDisplayField"(
        value: {
          #"SYSTEM_SYSRULES_richTextItem_v1"(
            text: concat("Traspaso de Operación: ", ri!reporte.operacion),
            size: "MEDIUM_PLUS",
            style: "STRONG"
          )
        },
        align: "LEFT"
      ),
      #"SYSTEM_SYSRULES_columnsLayout"(
        columns: {
          #"SYSTEM_SYSRULES_columnLayout"(
            contents: {
              #"SYSTEM_SYSRULES_cardLayout"(
                contents: {
                  #"SYSTEM_SYSRULES_columnsLayout"(
                    columns: {
                      #"SYSTEM_SYSRULES_columnLayout"(
                        contents: {
                          #"SYSTEM_SYSRULES_richTextDisplayField"(
                            value: {
                              #"SYSTEM_SYSRULES_richTextItem_v1"(
                                text: "Usuario Actual",
                                size: "MEDIUM_PLUS"
                              )
                            },
                            align: "CENTER"
                          ),
                          #"SYSTEM_SYSRULES_textField"(
                            label: "Usuario:",
                            labelPosition: "ABOVE",
                            value: local!usuarioActual,
                            readOnly: true,
                            align: "LEFT"
                          ),
                          #"SYSTEM_SYSRULES_textField"(
                            label: "Nombre:",
                            labelPosition: "ABOVE",
                            value: local!nombreActual,
                            readOnly: true,
                            align: "LEFT"
                          ),
                          #"SYSTEM_SYSRULES_textField"(
                            label: "Segmento:",
                            labelPosition: "ABOVE",
                            value: 
                            if(isnull(ri!reporte.usuario), "-", index(#"_a-0000e878-569a-8000-e5e4-01ef9001ef90_2233353"(idSegmento: 
                            if(
                              a!isNotNullOrEmpty(index(#"_a-0000e878-569a-8000-e5e4-01ef9001ef90_2152641"(usuarioOpic: ri!reporte.usuario),"data", null)),
                            index(#"_a-0000e878-569a-8000-e5e4-01ef9001ef90_2152641"(usuarioOpic: ri!reporte.usuario),"data","idsegmento", null),0)),"data","segmento", null)
                            ),
                            refreshAfter: "UNFOCUS",
                            readOnly: true,
                            validations: {}
                          )
                        },
                        width: "AUTO"
                      ),
                      #"SYSTEM_SYSRULES_columnLayout"(
                        contents: {
                          #"SYSTEM_SYSRULES_richTextDisplayField"(
                            value: {
                              #"SYSTEM_SYSRULES_richTextIcon"(
                                icon: "arrow-right",
                                color: "ACCENT",
                                size: "LARGE"
                              )
                            },
                            align: "CENTER"
                          )
                        },
                        width: "EXTRA_NARROW"
                      ),
                      #"SYSTEM_SYSRULES_columnLayout"(
                        contents: {
                          #"SYSTEM_SYSRULES_richTextDisplayField"(
                            value: {
                              #"SYSTEM_SYSRULES_richTextItem_v1"(
                                text: "Traspasar a",
                                size: "MEDIUM_PLUS"
                              )
                            },
                            align: "CENTER"
                          ),
                          #"SYSTEM_SYSRULES_dropdownField_v1"(
                            label: "Usuario",
                            labelPosition: "ABOVE",
                            placeholder: "---Seleccione un Usuario---",
                            choiceLabels: index(local!ejecutivos,"data","nombre",{}),
                            choiceValues: index(local!ejecutivos,"data","idacceso",{}),
                            value: local!id_ejecutivo,
                            saveInto: {
                              local!id_ejecutivo,
                              a!save(
                                local!usuario, 
                                if(
                                  a!isNullOrEmpty(local!id_ejecutivo),
                                  null(),
                                  index(#"4abb2c14-ac25-4b4a-a0f6-a11f52071c0b"(idacceso: local!id_ejecutivo, paginInfo: #"SYSTEM_SYSRULES_pagingInfo"(startIndex: 1,
                                  batchSize: 1)),"data","usuarioopics", null))
                                )
                            },
                            searchDisplay: "ON",
                            required: true
                          ),
                          #"SYSTEM_SYSRULES_textField"(
                            label: "Usuario a Traspasar:",
                            labelPosition: "ABOVE",
                            value: local!usuario,
                            readOnly: true,
                            align: "LEFT"
                          ),
                          #"SYSTEM_SYSRULES_textField"(
                            label: "Segmento:",
                            labelPosition: "ABOVE",
                            value:if(isnull(local!usuario), "-", 
                            index(#"_a-0000e878-569a-8000-e5e4-01ef9001ef90_2233353"(idSegmento: 
                            index(#"_a-0000e878-569a-8000-e5e4-01ef9001ef90_2152641"(usuarioOpic: local!usuario),"data","idsegmento", null),
                            paginInfo: #"SYSTEM_SYSRULES_pagingInfo"(startIndex: 1, batchSize: 1))
                            ,"data","segmento", null)),
                            refreshAfter: "UNFOCUS",
                            readOnly: true,
                            validations: {}
                          )
                        }
                      )
                    }
                  )
                }
              )
            },
            width: "AUTO"
          ),
          #"SYSTEM_SYSRULES_columnLayout"(
            contents: {
              #"SYSTEM_SYSRULES_cardLayout"(
                contents: {
                  #"SYSTEM_SYSRULES_richTextDisplayField"(
                    value: {
                      #"SYSTEM_SYSRULES_richTextItem_v1"(
                        text: "Detalles de la operación",
                        color: "ACCENT",
                        size: "MEDIUM"

                      )
                    },
                    align: "CENTER"
                  ),
                  #"SYSTEM_SYSRULES_columnsLayout"(
                    columns: {
                      #"SYSTEM_SYSRULES_columnLayout"(
                        contents: {
                          #"SYSTEM_SYSRULES_textField"(
                            label: "Contrato:",
                            labelPosition: "ABOVE",
                            value: ri!reporte.contrato,
                            readOnly: true
                          ),
                          #"SYSTEM_SYSRULES_textField"(
                            label: "Operación:",
                            labelPosition: "ABOVE",
                            value: ri!reporte.operacion,
                            readOnly: true
                          ),
                          #"SYSTEM_SYSRULES_textField"(
                            label: "Fecha de captura:",
                            labelPosition: "ABOVE",
                            value: ri!reporte.fechacaptura,
                            readOnly: true
                          )

                        }
                      ),
                      #"SYSTEM_SYSRULES_columnLayout"(
                        contents: {
                          #"SYSTEM_SYSRULES_textField"(
                            label: "Título:",
                            labelPosition: "ABOVE",
                            value: ri!reporte.titulo,
                            readOnly: true
                          ),
                          #"SYSTEM_SYSRULES_textField"(
                            label: "Mercado:",
                            labelPosition: "ABOVE",
                            value: ri!reporte.mercado,
                            readOnly: true
                          ),
                          #"SYSTEM_SYSRULES_textField"(
                            label: "Emisora:",
                            labelPosition: "ABOVE",
                            value: ri!reporte.emisora,
                            readOnly: true
                          )
                        }
                      )
                    }
                  )
                }
              )
            },
            width: "AUTO"
          )
        }
      ),
      #"SYSTEM_SYSRULES_ButtonLayout"(
        primaryButtons: {
          #"SYSTEM_SYSRULES_buttonWidget_v1"(
            label: "Traspasar",
            disabled:or( a!isNullOrEmpty(local!id_ejecutivo),ri!reporte.usuario=local!usuario),
            saveInto: {
              a!save(ri!reporte.usuario, local!usuario),
              #"SYSTEM_SYSRULES_startProcess"(
                processModel: #"_a-0000e9a7-6d42-8000-e63f-01ef9001ef90_5249038",
                processParameters: {
                  reporte: ri!reporte,
                },
                onSuccess: {
                  a!save(ri!showInformationBanner_actualizar, true),
                  if(
                    toboolean(fv!processInfo.pv.error) = false,
                    {a!save(ri!flag_actualizar, addseconds(now(), 10)),
                    a!save(ri!mostrarTraspaso, false),
                    a!save(ri!reporte, null),
                    a!save(local!usuario, null),
                    a!save(local!id_ejecutivo, null),
                    a!save(ri!operacion,null),
                    a!save(ri!operacionT,null),
                    a!save(ri!porTipo,null),
                    a!save(ri!porUsuario,null),
                    a!save(ri!porSegmento,null),
                    a!save(ri!refreshCount, ri!refreshCount +1)
                    },
                    a!save(ri!flag_error_actualizar, addseconds(now(), 10))
                  ),
                  /*a!save(ri!mostrarTraspaso, false),*/
                  /*a!save(ri!reporte, null),*/
                  /*a!save(local!usuario, null),*/
                  /*a!save(local!id_ejecutivo, null),*/
                  /*a!save(ri!refreshCount, ri!refreshCount +1)*/
                }
              )
            },  
            submit: true,
            style: "SOLID",
            loadingIndicator: true,
            confirmHeader: "¿Está seguro de que se desea hacer este traspaso?",
            confirmButtonLabel: "Sí, confirmar",
            cancelButtonLabel: "No"
          )
        },
        secondaryButtons: {
          #"SYSTEM_SYSRULES_buttonWidget_v1"(
            label: "Cancelar",
            loadingIndicator: true,
            value: false,
            saveInto: {
              a!save(ri!mostrarTraspaso, false),
              a!save(ri!reporte, null),
              a!save(local!usuario, null),
              a!save(local!id_ejecutivo, null)
            },
            submit: true,
            style: "GHOST",
            validate: false
          )
        }
      )
    },
    showBorder: false
  )
)</definition>
        <namedTypedValue>
            <name>mostrarTraspaso</name>
            <type>
                <name>boolean</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>reporte</name>
            <type>
                <name>cdo_reportes</name>
                <namespace>urn:com:appian:types</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>refreshCount</name>
            <type>
                <name>int</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>showInformationBanner_actualizar</name>
            <type>
                <name>boolean</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>flag_actualizar</name>
            <type>
                <name>dateTime</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>flag_error_actualizar</name>
            <type>
                <name>dateTime</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>operacionT</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>operacion</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>porTipo</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>porUsuario</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>porSegmento</name>
            <type>
                <name>int</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <preferredEditor>interface</preferredEditor>
        <offlineEnabled>false</offlineEnabled>
        <isCustom>false</isCustom>
    </interface>
    <roleMap public="true">
        <role inherit="true" allowForAll="false" name="readers">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="authors">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="administrators">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyReaders">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAuthors">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAdministrators">
            <users/>
            <groups/>
        </role>
    </roleMap>
    <history>
        <historyInfo versionUuid="_a-0000ea37-8f9d-8000-e646-01ef9001ef90_6876639"/>
        <historyInfo versionUuid="_a-0000eaa5-8248-8000-e681-01ef9001ef90_8218634"/>
        <historyInfo versionUuid="_a-0000eb09-d442-8000-e687-01ef9001ef90_8837162"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9389351"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9470678"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9508829"/>
        <historyInfo versionUuid="_a-0000ec5b-dce3-8000-e69f-01ef9001ef90_10134131"/>
    </history>
</contentHaul>
