<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contentHaul xmlns:a="http://www.appian.com/ae/types/2009">
    <versionUuid>_a-0000ec5b-dce3-8000-e69f-01ef9001ef90_10136411</versionUuid>
    <interface>
        <name>SCDO_GridUFaltantes</name>
        <uuid>_a-0000e878-569a-8000-e5e4-01ef9001ef90_2226568</uuid>
        <description>Interfaz con la tabla para los usuarios faltantes para SCDO.</description>
        <parentUuid>_a-0000e801-560f-8000-e5d9-01ef9001ef90_1707049</parentUuid>
        <visibility>
            <advertise>false</advertise>
            <hierarchy>true</hierarchy>
            <indexable>true</indexable>
            <quota>false</quota>
            <searchable>true</searchable>
            <system>false</system>
            <unlogged>false</unlogged>
        </visibility>
        <definition>a!localVariables(
  /*------------*/
  
  local!showInformationBanner_actualizar: true,
  local!showInformationBanner_eliminar: true,
  
  /*correcto_actualizar*/
  local!flag_actualizar: now(),
  
  /*-----*/
  /*error_actualizasr*/
  local!flag_error_actualizar: now(),
  local!showWhen_error_actualizar: a!refreshVariable(
    value: now() &lt; local!flag_error_actualizar,
    /* especifique el intervalo después de cuántos minutos desea finalizar el examen */
    refreshInterval: 0.5
  ),
  /*------*/
  /*correcto_eliminar*/
  local!flag_eliminar: now(),
  local!showWhen_eliminar: a!refreshVariable(
    value: now() &lt; local!flag_eliminar,
    refreshInterval: 0.5
  ),
  /*-----*/
  /*error_elimianr*/
  local!flag_error_eliminar: now(),
  local!showWhen_error_eliminar: a!refreshVariable(
    value: now() &lt; local!flag_error_eliminar,
    /* especifique el intervalo después de cuántos minutos desea finalizar el examen */
    refreshInterval: 0.5
  ),
  /*------*/
  /*------------*/
  local!mostrarSuccess: false,
  local!usuario,
  local!userSuccess,
  local!userDelete,
  local!indiceChoose: 1,
  local!indexDelete,
  local!deleteSuccess: false,
  local!usuariosFaltantes:#"_a-0000e9f5-96e6-8000-e641-01ef9001ef90_6675123"(usuario_buscar:local!usuario,refreshCount:ri!refreshCount),
  
  /*a!refreshVariable(*/
    /*value:rule!SCDO_ObtenerUsuariosFaltantes(usuario_buscar:local!usuario),*/
  /*refreshAlways: true,*/
  /*refreshOnVarChange: {ri!refreshCount}*/
/*),*/

  local!segmentoWrite,
  local!segmento: #"_a-0000e968-30a1-8000-e639-01ef9001ef90_4305675"(paginInfo: #"SYSTEM_SYSRULES_pagingInfo"(1, 100)),
  local!colorEdit: "#0032E6",
  local!colorDV: "#EC0000",
  local!colorSave: "#1F8926",
  /*local!segmentos: rule!SCDO_getSegmentoByFilters(idSegmento: null).data,*/
  local!editGrid: - 1,
  {
    #"SYSTEM_SYSRULES_sectionLayout_v1"(
      label: "",
      contents: {
        #"SYSTEM_SYSRULES_richTextDisplayField"(
          labelPosition: "COLLAPSED",
          instructions: "",
          value: {
            "Muestra los usuarios opics que se encuentran en la base de datos pero no se les ha asignado ejecutivo para subir documentación. Si el usuario opics no tiene asignado un ejecutivo, las operaciones no pueden ser revisadas."
          },
          align: "LEFT"
        ),
        #"SYSTEM_SYSRULES_richTextDisplayField"(
          labelPosition: "COLLAPSED",
          value: {
            #"SYSTEM_SYSRULES_richTextItem_v1"(
              text: "*Nota: Para actualizar un usuario faltante debe seleccionar un segmento",
              color: local!colorDV
            )
          }
        )
      },
      divider: "BELOW"
    ),
    #"SYSTEM_SYSRULES_columnsLayout"(
      columns: {
        #"SYSTEM_SYSRULES_columnLayout"(contents: {
  #"SYSTEM_SYSRULES_textField"(
    label: "Buscar por Usuario:",
    labelPosition: "ABOVE",
    value:local!usuario,
    saveInto: {local!usuario},
    refreshAfter: "KEYPRESS",
    validations: {}
  )
}),
        #"SYSTEM_SYSRULES_columnLayout"(contents: {
  #"SYSTEM_SYSRULES_ButtonArrayLayout"(
    buttons: {
      #"SYSTEM_SYSRULES_buttonWidget_v1"(
        label: "Buscar",
        icon: "search",
        saveInto: {
          
          a!save(ri!refreshCount,ri!refreshCount+1)
        
        },
        style: "GHOST",
        loadingIndicator: true
      )
    },
    align: "START"
  )
}),
        #"SYSTEM_SYSRULES_columnLayout"(
          contents: {
            choose(
              local!indiceChoose,
              #"SYSTEM_SYSRULES_cardLayout"(
                contents: {
                  #"SYSTEM_SYSRULES_richTextDisplayField"(
                    value: {
                      #"SYSTEM_SYSRULES_richTextItem_v1"(
                        text: concat(
                          "Se ha ",
                          if(
                            local!deleteSuccess,
                            "eliminado",
                            "registrado"
                          ),
                          " correctamente el usuario: ",
                          if(
                            local!deleteSuccess,
                            local!userDelete,
                            local!userSuccess
                          )
                        ),
                        color: "ACCENT",
                        style: "STRONG"
                      )
                    },
                    align: "CENTER"
                  ),
                  #"SYSTEM_SYSRULES_ButtonArrayLayout"(
                    buttons: {
                      #"SYSTEM_SYSRULES_ButtonWidget"(
                        label: "ACEPTAR",
                        icon: "check",
                        value: false,
                        saveInto: {
                          local!mostrarSuccess,
                          a!save(local!userSuccess, null),
                          a!save(local!userDelete,null),
                          a!save(local!deleteSuccess,false)
                        },
                        size: "SMALL",
                        style: "PRIMARY"
                      )
                    },
                    align: "CENTER"
                  )
                },
                showWhen: local!mostrarSuccess,
                style: "SUCCESS",
                showBorder: false
              ),
              #"SYSTEM_SYSRULES_cardLayout"(
                contents: {
                  #"SYSTEM_SYSRULES_richTextDisplayField"(
                    value: {
                      #"SYSTEM_SYSRULES_richTextItem_v1"(
                        text: "¿Está seguro que desea eliminar al usuario: "&amp;local!userDelete &amp;"?"&amp;char(10)&amp;"La acción es irrevocable",
                        color: "NEGATIVE",
                        style: "STRONG"
                      )
                    },
                    align: "CENTER"
                  ),
                  #"SYSTEM_SYSRULES_ButtonLayout"(
                    primaryButtons: {
                      #"SYSTEM_SYSRULES_buttonWidget_v1"(
                        label: "Sí, Eliminar",
                        icon: "trash",
                        saveInto: {
                          #"SYSTEM_SYSRULES_startProcess"(
                            processModel: #"_a-0000ea22-4ef8-8000-e643-01ef9001ef90_6714648",
                            processParameters: {
                              ids_reportes: 
                              index(#"SYSTEM_SYSRULES_queryEntity_v2"(
                                entity: #"_a-0000e878-569a-8000-e5e4-01ef9001ef90_1932909",
                                query: #"SYSTEM_SYSRULES_query"(
                                  selection: #"SYSTEM_SYSRULES_querySelection"(
                                    columns: { #"SYSTEM_SYSRULES_queryColumn"(field: "idreporte") }
                                  ),
                                  logicalExpression: #"SYSTEM_SYSRULES_queryLogicalExpression"(
                                    operator: "AND",
                                    filters: {
                                      #"SYSTEM_SYSRULES_queryFilter"(
                                        field: "usuario",
                                        operator: "=",
                                        value: local!userDelete
                                      )
                                    },
                                    ignoreFiltersWithEmptyValues: true
                                  ),
                                  pagingInfo: #"SYSTEM_SYSRULES_pagingInfo"(startIndex: 1, batchSize: - 1)
                                ),
                                fetchTotalCount: true
                              ),"data","idreporte", null)
                            },
                            onSuccess: {
                              a!save(
                                local!showInformationBanner_eliminar,
                                true
                              ),
                              if(
                                toboolean(fv!processInfo.pv.error) = false,
                                {a!save(
                                  local!flag_eliminar,
                                  addseconds(now(), 10)
                                ),
                               
                                a!save(ri!refreshCount,ri!refreshCount+1),
                                a!save(local!deleteSuccess, true),
                                a!save(local!mostrarSuccess, true),
                                a!save(local!indexDelete,null),
                                a!save(
                                  local!usuariosFaltantes,
                                  #"_a-0000e9f5-96e6-8000-e641-01ef9001ef90_6675123"(usuario_buscar:local!usuario,refreshCount:ri!refreshCount),
                                    
                                 
                                )
                                
                                },
                                a!save(
                                  local!flag_error_eliminar,
                                  addseconds(now(), 10)
                                )
                              ),
                              a!save(local!indiceChoose,1)
                            
                            }
                          )
                        },
                        size: "SMALL",
                        style: "GHOST",
                        loadingIndicator: true
                      )
                    },
                    secondaryButtons: {
                      #"SYSTEM_SYSRULES_buttonWidget_v1"(
                        label: "Cancelar",
                        icon: "times",
                        saveInto: {
                          a!save(local!indiceChoose, 1),
                          a!save(local!userSuccess, null)
                        },
                        size: "SMALL",
                        style: "GHOST"
                      )
                    }
                  )
                },
                style: "WARN",
                showBorder: false
              )
            )
          }
        )
      }
    ),
    #"SYSTEM_SYSRULES_columnsLayout"(
      columns: {
      
        /*ERROR ACTUALIZAR*/
        #"SYSTEM_SYSRULES_columnLayout"(
          contents: {
            #"_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9394317"(
              showInformationBanner: local!showInformationBanner_actualizar
            )
          },
          showWhen: and(
            local!showInformationBanner_actualizar,
            local!showWhen_error_actualizar
          )
        ),
        
        /*ERROR ELIMINAR*/
        #"SYSTEM_SYSRULES_columnLayout"(
          contents: {
            #"_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9394317"(
              showInformationBanner: local!showInformationBanner_eliminar
            )
          },
          showWhen: and(
            local!showInformationBanner_eliminar,
            local!showWhen_error_eliminar
          )
        )

      }
    ),
    #"SYSTEM_SYSRULES_cardLayout"(
      contents: {
        #"SYSTEM_SYSRULES_gridLayout"(
          label: "",
          labelPosition: "ABOVE",
          emptyGridMessage: "No existen usuarios faltantes",
          headerCells: {
            #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(label: "No."),
            #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(label: "Usuario"),
            #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(label: "Cantidad de Operaciones"),
            #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(label: "Segmento"),
            #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(label: "Acciones")
          },
          columnConfigs: {
            #"SYSTEM_SYSRULES_gridLayoutColumnConfig"(width: "DISTRIBUTE"),
            #"SYSTEM_SYSRULES_gridLayoutColumnConfig"(width: "DISTRIBUTE"),
            #"SYSTEM_SYSRULES_gridLayoutColumnConfig"(width: "DISTRIBUTE"),
            #"SYSTEM_SYSRULES_gridLayoutColumnConfig"(width: "DISTRIBUTE"),
            #"SYSTEM_SYSRULES_gridLayoutColumnConfig"(width: "ICON")
          },
          rows: #"SYSTEM_SYSRULES_forEach"(
            items: local!usuariosFaltantes,
            expression: {
              #"SYSTEM_SYSRULES_gridRowLayout"(
                id: fv!index,
                contents: {
                  #"SYSTEM_SYSRULES_textField"(
                    value: fv!index,
                    readOnly: true,
                    align: "CENTER"
                  ),
                  #"SYSTEM_SYSRULES_textField"(
                    value: fv!item.usuario,
                    readOnly: true,
                    align: "CENTER"
                  ),
                  #"SYSTEM_SYSRULES_textField"(
                    value: concat(
                      fv!item.usuario_count,
                      " Operaciones del usuario"
                    ),
                    readOnly: true,
                    align: "CENTER"
                  ),
                  #"SYSTEM_SYSRULES_dropdownField_v1"(
                    placeholder: "Seleccione el segmento",
                    choiceLabels: { index(local!segmento,"segmento",{}) },
                    choiceValues: { index(local!segmento,"idsegmento",{}) },
                    value: if(
                      local!editGrid = fv!index,
                      local!segmentoWrite,
                      null
                    ),
                    saveInto: local!segmentoWrite,
                    disabled: not(local!editGrid = fv!index)
                  ),
                  #"SYSTEM_SYSRULES_richTextDisplayField"(
                    value: {
                      #"SYSTEM_SYSRULES_richTextIcon"(
                        icon: "pencil-square-o",
                        caption: "Editar",
                        link: #"SYSTEM_SYSRULES_dynamicLink"(
                          saveInto: {
                            a!save(local!editGrid, fv!index),
                            a!save(local!indiceChoose, 1)
                          }
                        ),
                        linkStyle: "STANDALONE",
                        showWhen: local!editGrid = - 1,
                        color: local!colorEdit
                      ),
                      
                      #"SYSTEM_SYSRULES_richTextIcon"(
                        icon: "pencil-square-o",
                        caption: "Descartar",
                        link: #"SYSTEM_SYSRULES_dynamicLink"(
                          saveInto: {
                            a!save(local!editGrid, - 1),
                            a!save(local!segmentoWrite, null),
                            a!save(local!indiceChoose,1)
                          }
                        ),
                        linkStyle: "STANDALONE",
                        showWhen: local!editGrid = fv!index,
                        color: "#222222"
                      ),
                      #"SYSTEM_SYSRULES_richTextIcon"(
                        icon: "file-invoice",
                        caption: "Registrar",
                        link: #"SYSTEM_SYSRULES_dynamicLink"(
                          saveInto: {
                            
                            #"SYSTEM_SYSRULES_startProcess"(
                              processModel: #"_a-0000eabf-35e2-8000-e683-01ef9001ef90_8477045",
                              processParameters: {
                                usuario: fv!item.usuario,
                                idsegmento: local!segmentoWrite

                              },
                              onSuccess: {
                                a!save(
                                  local!showInformationBanner_actualizar,
                                  true
                                ),
                                if(
                                  toboolean(fv!processInfo.pv.error) = false,
                                 { a!save(
                                    local!flag_actualizar,
                                    addseconds(now(), 10)
                                  ),
                                  a!save(local!deleteSuccess,false),
                                  a!save(local!mostrarSuccess, true),
                                  a!save(local!userSuccess, fv!item.usuario),
                                  a!save(local!indiceChoose,1),
                                  a!save(local!segmentoWrite, null),
                                  
                                  a!save(ri!refreshCount,ri!refreshCount+1),
                                  a!save(
                                    local!usuariosFaltantes,
                                    #"_a-0000e9f5-96e6-8000-e641-01ef9001ef90_6675123"(usuario_buscar:local!usuario,refreshCount:ri!refreshCount),


                                  )
                                 },
                                  a!save(
                                    local!flag_error_actualizar,
                                    addseconds(now(), 10)
                                  )
                                )
                          
                              }


                            ),
                            a!save(local!editGrid, - 1)
                          }
                        ),
                        linkStyle: "STANDALONE",
                        showWhen: and(
                          local!editGrid = fv!index,
                          a!isNotNullOrEmpty(local!segmentoWrite),
                          a!isNotNullOrEmpty(local!segmentoWrite)
                        ),
                        color: local!colorSave
                      ),
                      #"SYSTEM_SYSRULES_richTextIcon"(
                        icon: "times",
                        caption: "Eliminar Usuario",
                        link: #"SYSTEM_SYSRULES_dynamicLink"(
                          saveInto: {
                            a!save(local!indiceChoose,2),
                            a!save(local!userDelete,fv!item.usuario),
                            a!save(local!indexDelete,fv!index),
                            a!save(local!editGrid,-1)
                          }
                        ),
                        linkStyle: "STANDALONE",
                        color: local!colorDV
                      )
                    },
                    align: "CENTER"
                  )
                }
              )
            }
          ),
          selectionSaveInto: {},
          validations: {},
          shadeAlternateRows: true
        )
      },
      height: "TALL",
      style: "NONE",
      marginBelow: "STANDARD",
      showBorder: false
    )
  }
)</definition>
        <namedTypedValue>
            <name>refreshCount</name>
            <type>
                <name>int</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <preferredEditor>interface</preferredEditor>
        <offlineEnabled>false</offlineEnabled>
        <isCustom>false</isCustom>
    </interface>
    <roleMap public="true">
        <role inherit="true" allowForAll="false" name="readers">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="authors">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="administrators">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyReaders">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAuthors">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAdministrators">
            <users/>
            <groups/>
        </role>
    </roleMap>
    <history>
        <historyInfo versionUuid="_a-0000e878-569a-8000-e5e4-01ef9001ef90_2226573"/>
        <historyInfo versionUuid="_a-0000ea22-4ef8-8000-e643-01ef9001ef90_6728559"/>
        <historyInfo versionUuid="_a-0000eabf-35e2-8000-e683-01ef9001ef90_8477113"/>
        <historyInfo versionUuid="_a-0000eb09-d442-8000-e687-01ef9001ef90_8799519"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9388777"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9404947"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9449616"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9466025"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9497372"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9553942"/>
        <historyInfo versionUuid="_a-0000ec5b-dce3-8000-e69f-01ef9001ef90_10136411"/>
    </history>
</contentHaul>
