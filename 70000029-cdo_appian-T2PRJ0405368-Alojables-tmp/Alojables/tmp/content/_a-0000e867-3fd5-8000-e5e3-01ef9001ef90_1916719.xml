<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contentHaul xmlns:a="http://www.appian.com/ae/types/2009">
    <versionUuid>_a-0000ec5b-dce3-8000-e69f-01ef9001ef90_10125062</versionUuid>
    <interface>
        <name>SCDO_Documento_Ejecutivo</name>
        <uuid>_a-0000e867-3fd5-8000-e5e3-01ef9001ef90_1916719</uuid>
        <description>Interface relacionada a el modulo  de Ejecutivo</description>
        <parentUuid>_a-0000e801-560f-8000-e5d9-01ef9001ef90_1707049</parentUuid>
        <visibility>
            <advertise>false</advertise>
            <hierarchy>true</hierarchy>
            <indexable>true</indexable>
            <quota>false</quota>
            <searchable>true</searchable>
            <system>false</system>
            <unlogged>false</unlogged>
        </visibility>
        <definition>a!localVariables(
  local!nombre_documento: concat(
    ri!contrato,
    "_",
    ri!ejecutivo.usuarioopics,
    "_",
    text(now(), "yyyy-MM-dd hh_mm_ss")
  ),
  local!documentacion_a_modificar_id_doc_1: if(
    a!isNotNullOrEmpty(
      index(#"_a-0000e8b2-d897-8000-e5f1-01ef9001ef90_2372887"(contrato: ri!contrato, iddocumento: 1),"data",null)
    ),
    index(#"_a-0000e8b2-d897-8000-e5f1-01ef9001ef90_2372887"(contrato: ri!contrato, iddocumento: 1),"data", null),
    null
  ),
  local!documentacion_a_eliminar_id_doc_1: if(
    a!isNotNullOrEmpty(
      #"_a-0000e982-d80b-8000-e63b-01ef9001ef90_4763710"(contrato: ri!contrato, iddocumento: 1)
    ),
    #"_a-0000e982-d80b-8000-e63b-01ef9001ef90_4763710"(contrato: ri!contrato, iddocumento: 1),
    null
  ),
  local!cartel_contrato_existe: false,
  /* Se obtiene los catalogos de documentos del segmento */
  local!catalogoDelSegmento: if(
    a!isNullOrEmpty(
      #"_a-0000e968-30a1-8000-e639-01ef9001ef90_4493495"(
        idsegmento: ri!ejecutivo.idsegmento,
        pagingInfo: #"SYSTEM_SYSRULES_pagingInfo"(startIndex: 1, batchSize: 500)
      )
    ),
    null,
    #"_a-0000e968-30a1-8000-e639-01ef9001ef90_4493570"(
      idsDocumentos: index(#"_a-0000e968-30a1-8000-e639-01ef9001ef90_4493495"(
        idsegmento: ri!ejecutivo.idsegmento,
        pagingInfo: #"SYSTEM_SYSRULES_pagingInfo"(startIndex: 1, batchSize: 500)
      ),"iddocumento",null)
    ),

  ),
  /* Se obtiene los catalogos de documentos del segmento por Contrato y ADF*/
  local!catDocContratoGeneral: 
  if(
    a!isNullOrEmpty(local!catalogoDelSegmento),
    null,
    reject(
      fn!isnull,
      #"SYSTEM_SYSRULES_forEach"(
        items: local!catalogoDelSegmento,
        expression: if(
          and(
            index(fv!item,"documentaa",null) = "CONTRATO",
            if(
              a!isNotNullOrEmpty(index(fv!item,"adf",null)),
              tointeger(index(fv!item,"adf",null)) &lt;&gt; 1,
              true
            )
          ),
          fv!item,
          null
        )
      )
    ),

  ),
  
  local!catDocADFGeneral: if(
    a!isNullOrEmpty(local!catalogoDelSegmento),
    null,
    reject(
      fn!isnull,
      #"SYSTEM_SYSRULES_forEach"(
        items: local!catalogoDelSegmento,
        expression: if(
          and(
            index(fv!item,"documentaa",null) = "CONTRATO",
            a!isNotNullOrEmpty(index(fv!item,"adf",null)),
            tointeger(index(fv!item,"adf",null)) = 1
          ),
          fv!item,
          null
        )
      )
    ),

  ),
  /* Se obtiene los catalogos de documentos del segmento por Operacion*/
  local!catDocOperacionGeneral: if(
    a!isNullOrEmpty(local!catalogoDelSegmento),
    null,
    reject(
      fn!isnull,
      #"SYSTEM_SYSRULES_forEach"(
        items: local!catalogoDelSegmento,
        expression: if(
          index(fv!item,"documentaa",null) = "OPERACION",
          fv!item,
          null
        )
      )
    ),

  ),
  /* Se obtienen los documentos que ya estan registrados para el contrato en imagenes pendientes  */
  local!documentos/*:rule!SCDO_get_imagenesPendientesByFilters(contrato: ri!contrato)*/,
  local!activo: null,
  local!observacion,
  local!deal,
  local!documentoADF,
  local!documentocontrato,
  local!documentoperacion,
  local!documento,
  {
    if(
      and(
        /*len(ri!contrato)=11,*/a!isNullOrEmpty(local!documentos),
        a!isNotNullOrEmpty(local!catalogoDelSegmento)
      ),
      {
        #"SYSTEM_SYSRULES_columnsLayout"(
          /*showWhen:isnull(local!activo) ,*/
          columns: {
            #"SYSTEM_SYSRULES_columnLayout"(
              contents: {
                #"SYSTEM_SYSRULES_cardLayout"(
                  contents: {
                    #"SYSTEM_SYSRULES_richTextDisplayField"(
                      value: #"SYSTEM_SYSRULES_richTextItem_v1"(
                        text: "El contrato no existe en las operaciones pendientes, si desea adjuntar sus documentos correspondientes agrega el número de operación/deal",
                        color: "NEGATIVE",
                        style: "STRONG"
                      )
                    ),
                    #"SYSTEM_SYSRULES_columnLayout"(
                      contents: {
                        #"SYSTEM_SYSRULES_textField"(
                          label: "Operación/deal",
                          labelPosition: "ADJACENT",
                          value: local!deal,
                          saveInto: {
                            local!deal,
                            a!save(local!cartel_contrato_existe, false)/*a!save(*/
                            /*local!deal,*/
                            /*if(*/
                            /*a!isNotNullOrEmpty(local!deal),*/
                            /*rule!SIGC_ELIMINAR_LETRA_DE_TEXTO(texto:local!deal,),*/
                            /*null*/
                            /**/
                            /*)*/
                            /*)*/
                            /*cleanwith(local!deal,"1234567890")*/
                          },
                          /*characterLimit: 8,*/
                          refreshAfter: "KEYPRESS"
                        )
                      },
                      width: "MEDIUM"
                    )
                  },
                  style: "STANDARD",
                  marginAbove: "MORE",
                  marginBelow: "MORE"
                )
              },
              width: "WIDE"
            )
          }
        ),
        /*rule!SCDO_Ejecutivo_LLamada(bitacora: local!observacion,activo: local!activo, refreshCount: ri!refreshCount, esImagenPendiente: ri!esImagenPendiente, ejecutivo: ri!ejecutivo, deal: local!deal, contrato: ri!contrato),*/
        #"_a-0000eaa5-8248-8000-e681-01ef9001ef90_8314689"(
          contrato: ri!contrato,
          deal: local!deal,
          activo: local!activo,
          ejecutivo: ri!ejecutivo,
          cartel_contrato_existe: local!cartel_contrato_existe
        ),
        #"SYSTEM_SYSRULES_columnsLayout"(
          columns: {
            #"SYSTEM_SYSRULES_columnLayout"(
              contents: {
                #"SYSTEM_SYSRULES_richTextDisplayField"(
                  value: {
                    #"SYSTEM_SYSRULES_richTextItem_v1"(text: "Documentos por Contrato "),
                    #"SYSTEM_SYSRULES_richTextIcon"(icon: "arrow-down")
                  }
                ),
                if(a!isNotNullOrEmpty(local!catDocContratoGeneral),
                #"SYSTEM_SYSRULES_checkboxField"(
                  label: "",
                  labelPosition: "ABOVE",
                  choiceLabels: index(local!catDocContratoGeneral,"documento",{}),
                  choiceValues: index(local!catDocContratoGeneral,"iddocumento",{}),
                  value: local!documentocontrato,
                  saveInto: local!documentocontrato,
                  disabled: a!isNotNullOrEmpty(local!activo),
                  validations: {}
                ),
                {}
                ),
               
                if(
                  a!isNotNullOrEmpty(local!catDocADFGeneral),
                  #"SYSTEM_SYSRULES_checkboxField"(
                    label: "",
                    labelPosition: "ABOVE",
                    choiceLabels: index(local!catDocADFGeneral,"documento",{}),
                    choiceValues: index(local!catDocADFGeneral,"iddocumento",{}),
                    value: local!documentoADF,
                    saveInto: local!documentoADF,
                    disabled: a!isNotNullOrEmpty(local!activo),
                    validations: {}
                  ),
                  {}
                )
              }
            ),
            #"SYSTEM_SYSRULES_columnLayout"(
              contents: {
                #"SYSTEM_SYSRULES_richTextDisplayField"(
                  value: {
                    #"SYSTEM_SYSRULES_richTextItem_v1"(text: "Documentos por Operación "),
                    #"SYSTEM_SYSRULES_richTextIcon"(icon: "arrow-down")
                  }
                ),
                if(
                  a!isNullOrEmpty(local!catDocOperacionGeneral),
                  {
                    #"SYSTEM_SYSRULES_richTextDisplayField"(
                      value: #"SYSTEM_SYSRULES_richTextItem_v1"(
                        text: "No existen documentos para introducir de tipo Operación",
                        color: "NEGATIVE",

                      )
                    )
                  },
                  if(a!isNotNullOrEmpty(local!catDocOperacionGeneral),
                  #"SYSTEM_SYSRULES_checkboxField"(
                    label: "",
                    labelPosition: "ABOVE",
                    choiceLabels: index(local!catDocOperacionGeneral,"documento",{}),
                    choiceValues: index(local!catDocOperacionGeneral,"iddocumento",{}),
                    value: local!documentoperacion,
                    saveInto: local!documentoperacion,
                    disabled: a!isNotNullOrEmpty(local!activo),
                    validations: {}
                  ),{}
                  )
                
                )
              }
            )
          }
        ),
        #"SYSTEM_SYSRULES_columnsLayout"(
          columns: {
            #"SYSTEM_SYSRULES_columnLayout"(
              contents: {
                #"SYSTEM_SYSRULES_fileUploadField_v1"(
                  label: "Subir Archivo",
                  instructions: if(
                    and(
                      a!isNullOrEmpty(local!documentocontrato),
                      a!isNullOrEmpty(local!documentoperacion)
                    ),
                    "Seleccione un documento para poder subir el archivo",
                    ""
                  ),
                  target: /*cons!SCDO_CARPETA_DOCUMENTOS_IMAGENES_PENDIENTES*/#"_a-0000e9a7-6d42-8000-e63f-01ef9001ef90_5940527",
                  maxSelections: 1,
                  value: local!documento,
                  saveInto: {
                    a!save(
                      local!documento,
                      if(
                        a!isNullOrEmpty(save!value),
                        null,
                        #"c1a88e05-5d06-4b4b-92d2-f58a10499d1b"(document: tostring(save!value))
                      )
                    ),

                  },
                  fileNames: 
                  
                  local!nombre_documento,
                  disabled: if(
                    or(
                      and(
                        a!isNullOrEmpty(local!documentoADF),
                        a!isNullOrEmpty(local!documentocontrato),
                        a!isNullOrEmpty(local!documentoperacion)
                      ),
                      a!isNotNullOrEmpty(local!activo)
                    ),
                    true,
                    false
                  )
                )
              }
            ),
            #"SYSTEM_SYSRULES_columnLayout"(
              contents: {
                #"SYSTEM_SYSRULES_ButtonArrayLayout"(
                  buttons: {
                    #"SYSTEM_SYSRULES_ButtonWidget"(
                      label: "Cancelar",
                      value: { {} },
                      saveInto: {
                        local!documentocontrato,
                        local!documentoperacion,
                        a!save(local!documentoADF, null),
                        a!save(local!documento, null)
                      },
                      style: "DESTRUCTIVE",
                      disabled: if(
                        and(
                          a!isNullOrEmpty(local!documentoADF),
                          a!isNullOrEmpty(local!documentocontrato),
                          a!isNullOrEmpty(local!documentoperacion)
                        ),
                        true,
                        false
                      )
                    ),
                    #"SYSTEM_SYSRULES_ButtonWidget"(
                      label: "Guardar",
                      saveInto: {
                        a!save(
                          local!documentos,
                          #"_a-0000e982-d80b-8000-e63b-01ef9001ef90_4679364"(
                            contrato: ri!contrato,
                            deal: local!deal,
                            cc: ri!ejecutivo.idsegmento,
                            usuario: ri!ejecutivo.usuarioopics
                          ),

                        ),
                        a!save(
                          local!cartel_contrato_existe,
                          if(
                            a!isNotNullOrEmpty(local!documentos),
                            true,
                            false
                          )
                        ),
                        if(
                          a!isNullOrEmpty(local!documentos),
                          #"SYSTEM_SYSRULES_startProcess"(
                            processModel: #"_a-0000e9a7-6d42-8000-e63f-01ef9001ef90_4876425",
                            processParameters: {
                              nombre_documento: local!nombre_documento,  
                              contrato: ri!contrato,
                              ipremota: "", 
                              operacion: local!deal,
                              idsDocumentosPorContrato: if(
                                and(
                                  a!isNullOrEmpty(local!documentocontrato),
                                  a!isNullOrEmpty(local!documentoADF)
                                ),
                                null,
                                reject(
                                  fn!isnull,
                                  a!flatten(
                                    union(
                                      tointeger(local!documentoADF),
                                      tointeger(local!documentocontrato)
                                    )
                                  )
                                )
                              ),
                              idsDocumentosPorOperacion: if(
                                a!isNullOrEmpty(local!documentoperacion),
                                null,
                                tointeger(local!documentoperacion)
                              ),
                              lista_documentacion_a_modificar_id_doc_1: local!documentacion_a_modificar_id_doc_1,
                              lista_documentacion_a_eliminar_id_doc_1: local!documentacion_a_eliminar_id_doc_1,
                              ejecutivo: ri!ejecutivo,

                            },
                            onSuccess: {
                              a!save(ri!contrato, null),
                              a!save(local!documento, null),
                              a!save(local!documentoADF, null),
                              a!save(local!documentocontrato, null),
                              a!save(local!documentoperacion, null),
                              a!save(local!observacion, null),
                              a!save(local!activo, null),
                              a!save(local!deal, null),
                              a!save(local!nombre_documento, null)
                            }
                          ),
                      
                          ""
                        )
                      },
                      submit: true,
                      style: "PRIMARY",
                      loadingIndicator: true,
                      icon: "save",
                      disabled: {
                        a!match(value:  or(
                          and(
                            a!isNullOrEmpty(local!documentoADF),
                            a!isNullOrEmpty(local!documentocontrato),
                            a!isNullOrEmpty(local!documentoperacion)
                          ),
                          a!isNotNullOrEmpty(local!activo)
                        ),equals: true(),
                        then: true(),
                        whenTrue: or(
                          a!isNullOrEmpty(local!documento),
                          a!isNullOrEmpty(local!deal)
                        ),
                        then: true(),
                        default: false()
                        
                        )
                        
                        
                        
                     
                      }
                    )
                  },
                  align: "CENTER",
                  marginAbove: "MORE"
                )
              }
            ),
            #"SYSTEM_SYSRULES_columnLayout"(contents: {})
          }
        )
      },
      {}
    ),
    /*if(*/
    /*a!isNotNullOrEmpty(local!documentos),*/
    {
      #"SYSTEM_SYSRULES_richTextDisplayField"(
        showWhen: and(
          local!cartel_contrato_existe,
          a!isNotNullOrEmpty(ri!contrato)
        ),
        value: {
          #"SYSTEM_SYSRULES_richTextIcon"(
            icon: "warning",
            size: "MEDIUM",
            color: "NEGATIVE"
          ),
          #"SYSTEM_SYSRULES_richTextItem_v1"(
            text: " El contrato buscado ya existe en las operaciones pendientes",
            color: "NEGATIVE",
            size: "MEDIUM",
            style: "STRONG"
          )
        }
      )
    },
    /*{}*/
    /*),*/
    if(
      a!isNullOrEmpty(local!catalogoDelSegmento),
      #"SYSTEM_SYSRULES_richTextDisplayField"(
        value: {
          #"SYSTEM_SYSRULES_richTextIcon"(
            icon: "warning",
            color: "NEGATIVE",
            size: "MEDIUM"
          ),
          #"SYSTEM_SYSRULES_richTextItem_v1"(
            text: " El segmento no tiene catálogos de documentos asociados, comuníquese con su el admininstrador para solucionar este problema",
            color: "NEGATIVE",
            size: "MEDIUM",
            style: "STRONG"
          )
        }
      ),
      {}
    )
  }
)</definition>
        <namedTypedValue>
            <name>contrato</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <namedTypedValue>
            <name>ejecutivo</name>
            <type>
                <name>V_CDO_Ejecutivo</name>
                <namespace>urn:com:appian:types</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>refreshCount</name>
            <type>
                <name>int</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>esImagenPendiente</name>
            <type>
                <name>boolean</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <preferredEditor>interface</preferredEditor>
        <offlineEnabled>false</offlineEnabled>
        <isCustom>false</isCustom>
    </interface>
    <roleMap public="true">
        <role inherit="true" allowForAll="false" name="readers">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="authors">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="administrators">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyReaders">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAuthors">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAdministrators">
            <users/>
            <groups/>
        </role>
    </roleMap>
    <typedValue>
        <type>
            <name>RuleTestConfig?list</name>
            <namespace>http://www.appian.com/ae/types/2009</namespace>
        </type>
        <value>
            <el>
                <a:name/>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">"12345600011"</a:value>
                    <a:nameRef>contrato</a:nameRef>
                    <a:id>1</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">'type!{urn:com:appian:types}V_CDO_Ejecutivo'(
  tipoacceso: "usuario-supervisor", fechaingreso: "1234", nombre: "BLANCA DESIREK CHAVEZ GONZALEZ", expediente: "X497975", idsegmento: 2, usuarioopics: "X497975", idacceso: 61
)</a:value>
                    <a:nameRef>ejecutivo</a:nameRef>
                    <a:id>2</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" xsi:type="xsd:int"/>
                    <a:nameRef>refreshCount</a:nameRef>
                    <a:id>3</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" xsi:type="xsd:boolean"/>
                    <a:nameRef>esImagenPendiente</a:nameRef>
                    <a:id>4</a:id>
                </a:ruleInputTestConfigs>
                <a:assertions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
            </el>
        </value>
    </typedValue>
    <history>
        <historyInfo versionUuid="_a-0000e916-edcb-8000-e60c-01ef9001ef90_3198838"/>
        <historyInfo versionUuid="_a-0000ea2e-319c-8000-e644-01ef9001ef90_6815046"/>
        <historyInfo versionUuid="_a-0000eaa5-8248-8000-e681-01ef9001ef90_8354286"/>
        <historyInfo versionUuid="_a-0000eabf-35e2-8000-e683-01ef9001ef90_8427701"/>
        <historyInfo versionUuid="_a-0000eae4-5659-8000-e685-01ef9001ef90_8697486"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9388669"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9533184"/>
        <historyInfo versionUuid="_a-0000eb9b-4ec6-8000-e68b-01ef9001ef90_9620178"/>
        <historyInfo versionUuid="_a-0000eb9b-4ec6-8000-e68b-01ef9001ef90_9647413"/>
        <historyInfo versionUuid="_a-0000ec5b-dce3-8000-e69f-01ef9001ef90_10125062"/>
    </history>
</contentHaul>
