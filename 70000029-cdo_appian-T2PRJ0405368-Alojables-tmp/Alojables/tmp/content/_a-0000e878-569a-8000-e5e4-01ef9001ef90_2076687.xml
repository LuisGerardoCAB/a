<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contentHaul xmlns:a="http://www.appian.com/ae/types/2009">
    <versionUuid>_a-0000ec5b-dce3-8000-e69f-01ef9001ef90_10131399</versionUuid>
    <interface>
        <name>SCDO_Grid2</name>
        <uuid>_a-0000e878-569a-8000-e5e4-01ef9001ef90_2076687</uuid>
        <description>Tabla con los Documentos por revisar</description>
        <parentUuid>_a-0000e801-560f-8000-e5d9-01ef9001ef90_1707049</parentUuid>
        <visibility>
            <advertise>false</advertise>
            <hierarchy>true</hierarchy>
            <indexable>true</indexable>
            <quota>false</quota>
            <searchable>true</searchable>
            <system>false</system>
            <unlogged>false</unlogged>
        </visibility>
        <definition>a!localVariables(
  /*Datos de prueba  */
  /*local!contrato: "60541900216",*/
  /*local!operacion: "2162118",*/
  /*local!documentacion: rule!SCDO_obtenerDocumentacionPendientePorContrato(contrato: "60541900216"),*/
  local!indicePagina: 1,
  local!digitalizadoSeleccionado,
  local!documentacionSeleccionada,
  local!decisionSeleccionada,
  local!indiceDocu,
  local!decisionFinal,
  local!rechazar,
  local!observaciones,
  local!digitalizado_pendientes:
  #"_a-0000e9f5-96e6-8000-e641-01ef9001ef90_6495671"(
    idReporte:index(ri!reporte,"idreporte", null),
    contrato: index(ri!reporte,"contrato", null),
    operacion:index(ri!reporte,"operacion", null)), 
  local!digitalizado_rechazado: 
  #"_a-0000e982-d80b-8000-e63b-01ef9001ef90_4776405"(
    idReporte:index(ri!reporte,"idreporte", null),
    operacion: index(ri!reporte,"operacion", null),
    contrato: index(ri!reporte,"contrato", null)),
  
  /*local!prueba: rule!SCDO_ALGUN_PENDIENTE(ri!digitalizados),*/
  {
    #"SYSTEM_SYSRULES_sectionLayout_v1"(
      label: "",
      contents: {
        #"SYSTEM_SYSRULES_sideBySideLayout"(
          items: {
            #"SYSTEM_SYSRULES_sideBySideItem"(
              item: #"SYSTEM_SYSRULES_ButtonArrayLayout"(
                buttons: {
                  #"SYSTEM_SYSRULES_buttonWidget_v1"(
                    label: "Salir",
                    style: "SOLID",
                    submit: true,
                    value: false,
                    saveInto: {
                      a!save(ri!mostrarGrid, true),
                      ri!mostrarDocumentos,
                     
                      /*a!save(local!digitalizado_pendientes, null),*/
                      a!save(local!digitalizado_pendientes,  #"_a-0000e9f5-96e6-8000-e641-01ef9001ef90_6495671"(
                        idReporte:index(ri!reporte,"idreporte", null),
                        contrato: index(ri!reporte,"contrato", null),
                        operacion:index(ri!reporte,"operacion", null)), ),
                      a!save(ri!documentacion, null),
                      a!save(local!observaciones, null),
                      a!save(ri!reporte, null),
                    },
                    size: "SMALL",
                    icon: "window-close"
                  )
                },
                align: "END"
              )
            )
          },
          showWhen: a!isNullOrEmpty(ri!soloDocumentos)
        ),
        #"SYSTEM_SYSRULES_richTextDisplayField"(
          value: {
            #"SYSTEM_SYSRULES_richTextItem_v1"(
              text: { "Documentación de Operación" },
              size: "MEDIUM_PLUS"
            )
          },
          align: "CENTER"
        )
      }
    ),
    choose(
      local!indicePagina,
      {
        {
          #"SYSTEM_SYSRULES_gridField_v1"(
            label: {
              concat(
                "Información del Contrato: ",
                a!match(value:   a!isNotNullOrEmpty(ri!reporte),
                equals: true(),
                then:  ri!reporte.contrato,
                whenTrue:  a!isNotNullOrEmpty(ri!reporteAprobado),
                then: ri!reporteAprobado.contrato,
                default:  "Sin contrato"
                ),
                " y Operación: ",
                a!match(value:   a!isNotNullOrEmpty(ri!reporte),
                equals: true(),
                then:   ri!reporte.operacion,
                whenTrue:  a!isNotNullOrEmpty(ri!reporteAprobado),
                then: ri!reporteAprobado.operacion,
                default:  "Sin operación"
                ),
              )
            },
            labelPosition: "ABOVE",
            emptyGridMessage: "No hay elementos para mostrar",
            data: local!digitalizado_pendientes,
            columns: {
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Documento",
                value: if(
                  a!isNullOrEmpty(
                    #"_a-0000e968-30a1-8000-e639-01ef9001ef90_4493570"(iddocumento: index(fv!row, "iddocumento",null))
                  ),
                  "NO",
                  index(#"_a-0000e968-30a1-8000-e639-01ef9001ef90_4493570"(iddocumento: index(fv!row, "iddocumento",null)),"documento", null)
                ),
                align: "CENTER",
                width: "AUTO"
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Archivo",
                value: if(
                  isnull(index(fv!row, "nombreimagen",null)),
                  "NO",
                  index(fv!row, "nombreimagen",null)
                ),
                align: "CENTER",
                width: "AUTO"
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Corresponde",
                value: "OPER",
                align: "CENTER",
                width: "AUTO"
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Estado",
                value: a!match(
                  value:  a!isNullOrEmpty(index(fv!row, "estado",null)),
                  equals: true(),
                  then: "NO",
                  whenTrue:  index(fv!row, "estado",null) = "P",
                  then:  "Pendiente",
                  whenTrue: index(fv!row, "estado",null) = "A",
                  then: "Aceptado",
                  default: "NO"
                ),
                align: "CENTER",
                width: "AUTO"
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Ver Doctos",
                value: a!localVariables(
                  local!documento_descargar,
                  local!busque: false,
                  #"SYSTEM_SYSRULES_richTextDisplayField"(
                    labelPosition: "COLLAPSED",
                    value: {
                      #"SYSTEM_SYSRULES_richTextIcon"(
                        icon: "file-signature",
                        link: {
                          #"SYSTEM_SYSRULES_dynamicLink"(
                            saveInto: {
                              #"SYSTEM_SYSRULES_startProcess"(
                                processModel: #"_a-0000eabf-35e2-8000-e683-01ef9001ef90_8425441",
                                processParameters: { nombre_doc: index(fv!row, "nombreimagen",null) },
                                onSuccess: {
                                  a!save(
                                    local!documento_descargar,
                                    fv!processInfo.pv.documento
                                  ),
                                  a!save(local!busque, true)

                                }
                              )

                            }
                          )

                        },
                        linkStyle: "STANDALONE"
                      ),
                      a!match(
                        value: local!busque,
                        equals: false(),
                        then:  "",
                        whenTrue: and(
                          local!busque,
                          a!isNotNullOrEmpty(local!documento_descargar)
                        ),
                        then: 
                        #"SYSTEM_SYSRULES_richTextIcon"(
                          icon: "download",
                          caption: "Descargar documento.",
                          link: {
                            #"SYSTEM_SYSRULES_documentDownloadLink"(document: local!documento_descargar)

                          },
                          linkStyle: "STANDALONE"
                        ),
                        default:  #"SYSTEM_SYSRULES_richTextIcon"(
                          icon: "exclamation",
                          caption: "Ha ocurrido un error al obtener el documento.",
                          linkStyle: "STANDALONE"
                        )
                      )
                    }
                  )

                ),
                /*a!richTextDisplayField(*/
                /*value: a!richTextIcon(*/
                /*icon: "file-signature",*/
                /*link: a!startProcessLink()*/
                /*)*/
                /*),*/
                align: "CENTER",
                width: "AUTO"
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Aceptar",
                value: #"SYSTEM_SYSRULES_richTextDisplayField"(
                  value: if(
                    index(fv!row, "estado",null) = "A",
                    {
                      #"SYSTEM_SYSRULES_richTextItem_v1"(text: "Aceptada", color: "#008000")
                    },
                    {
                      #"SYSTEM_SYSRULES_richTextIcon"(
                        icon: "check-circle-o",
                        link: #"SYSTEM_SYSRULES_dynamicLink"(
                          saveInto: {
                            a!save(local!indicePagina, 2),
                            a!save(local!digitalizadoSeleccionado, fv!row),
                            a!save(local!decisionSeleccionada, "Aceptar"),
                            a!save(local!indiceDocu, fv!identifier)
                          }
                        ),
                        linkStyle: "STANDALONE",
                        color: "POSITIVE"
                      )
                    }
                  )
                ),
                showWhen: a!isNullOrEmpty(ri!soloDocumentos),
                align: "CENTER",
                width: "AUTO"
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Rechazar",
                value: #"SYSTEM_SYSRULES_richTextDisplayField"(
                  value: if(
                    index(fv!row, "estado",null) = "A",
                    {},
                    {
                      #"SYSTEM_SYSRULES_richTextIcon"(
                        icon: "times-circle-o",
                        link: #"SYSTEM_SYSRULES_dynamicLink"(
                          saveInto: {
                            a!save(local!indicePagina, 2),
                            a!save(local!decisionSeleccionada, "Rechazar"),
                            a!save(local!digitalizadoSeleccionado, fv!row),
                            a!save(local!indiceDocu, fv!identifier),
                            

                          }
                        ),
                        linkStyle: "STANDALONE",
                        color: "NEGATIVE"
                      )
                    }
                  )
                ),
                showWhen: a!isNullOrEmpty(ri!soloDocumentos),
                align: "CENTER",
                width: "AUTO"
              )
            },
            spacing: "DENSE"
          ),
          #"SYSTEM_SYSRULES_gridField_v1"(
            label: {
              "Información de la documentación rechazada"
            },
            labelPosition: "ABOVE",
            emptyGridMessage: "No hay elementos para mostrar",
            data: local!digitalizado_rechazado,
            columns: {
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Documento",
                value: if(
                  a!isNullOrEmpty(
                    #"_a-0000e968-30a1-8000-e639-01ef9001ef90_4493570"(iddocumento: index(fv!row, "iddocumento",null))
                  ),
                  "NO",
                  index(#"_a-0000e968-30a1-8000-e639-01ef9001ef90_4493570"(iddocumento: index(fv!row, "iddocumento",null)),"documento",null)
                ),
                align: "CENTER",
                width: "AUTO"
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Archivo",
                value: if(
                  isnull(index(fv!row, "nombreimagen",null)),
                  "NO",
                  index(fv!row, "nombreimagen",null)
                ),
                align: "CENTER",
                width: "AUTO"
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Corresponde",
                value: "OPER",
                align: "CENTER",
                width: "AUTO"
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Estado",
                value: "Rechazada",
                align: "CENTER",
                width: "AUTO"
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Usuario Rechazó",
                value: if(
                  a!isNullOrEmpty(index(fv!row, "usuariorechazo", null)),
                  "-",
                  index(fv!row, "usuariorechazo", null)
                ),
                align: "CENTER",
                width: "AUTO"
              ),
              #"SYSTEM_SYSRULES_gridColumn"(
                label: "Ver Doctos",
                value: a!localVariables(
                  local!documento_descargar,
                  local!busque: false,
                  #"SYSTEM_SYSRULES_richTextDisplayField"(
                    labelPosition: "COLLAPSED",
                    value: {
                      #"SYSTEM_SYSRULES_richTextIcon"(
                        icon: "file-signature",
                        link: {
                          #"SYSTEM_SYSRULES_dynamicLink"(
                            saveInto: {
                              #"SYSTEM_SYSRULES_startProcess"(
                                processModel: #"_a-0000eabf-35e2-8000-e683-01ef9001ef90_8425441",
                                processParameters: { nombre_doc: index(fv!row, "nombreimagen",null) },
                                onSuccess: {
                                  a!save(
                                    local!documento_descargar,
                                    fv!processInfo.pv.documento
                                  ),
                                  a!save(local!busque, true)

                                }
                              )

                            }
                          )

                        },
                        linkStyle: "STANDALONE"
                      ),
                      a!match(
                        value: local!busque,
                        equals: false(),
                        then:  "",
                        whenTrue: and(
                          local!busque,
                          a!isNotNullOrEmpty(local!documento_descargar)
                        ),
                        then: 
                        #"SYSTEM_SYSRULES_richTextIcon"(
                          icon: "download",
                          caption: "Descargar documento.",
                          link: {
                            #"SYSTEM_SYSRULES_documentDownloadLink"(document: local!documento_descargar)

                          },
                          linkStyle: "STANDALONE"
                        ),
                        default:  #"SYSTEM_SYSRULES_richTextIcon"(
                          icon: "exclamation",
                          caption: "Ha ocurrido un error al obtener el documento.",
                          linkStyle: "STANDALONE"
                        )
                      )
                    }
                  )

                ),
                /*a!richTextDisplayField(*/
                /*value: a!richTextIcon(*/
                /*icon: "file-signature",*/
                /*link: a!startProcessLink()*/
                /*)*/
                /*),*/
                align: "CENTER",
                width: "AUTO"
              )

            },
            spacing: "DENSE"
          )
        },
        #"SYSTEM_SYSRULES_columnsLayout"(
          columns: {
            #"SYSTEM_SYSRULES_columnLayout"(
              contents: {
                #"SYSTEM_SYSRULES_richTextDisplayField"(
                  label: "",
                  value: {
                    #"SYSTEM_SYSRULES_richTextIcon"(icon: "info", color: "NEGATIVE"),
                    #"SYSTEM_SYSRULES_richTextItem_v1"(
                      text: "Si desea aceptar o rechazar la operación debe ingresar un comentario",
                      color: "NEGATIVE",
                      size: "SMALL"
                    )
                  },
                  marginAbove: "MORE",
                  marginBelow: "NONE"
                ),
                #"SYSTEM_SYSRULES_paragraphField"(
                  label: "",
                  labelPosition: "ABOVE",
                  value: local!observaciones,
                  saveInto: {
                    local!observaciones
                    
                  },
                  refreshAfter: "KEYPRESS",
                  validations: {}
                )
              }
            ),
            #"SYSTEM_SYSRULES_columnLayout"(contents: {})
          },
          showWhen: a!isNullOrEmpty(ri!soloDocumentos)
        ),
        #"SYSTEM_SYSRULES_sideBySideLayout"(
          items: {
            #"SYSTEM_SYSRULES_sideBySideItem"(
              item: #"SYSTEM_SYSRULES_ButtonArrayLayout"(
                buttons: {
                  #"SYSTEM_SYSRULES_ButtonWidget"(
                    label: "Aceptar",
                    style: "SECONDARY",
                    confirmMessage: "El reporte pasará a estar en el apartado de Revisados",
                    /*disabled: a!isNullOrEmpty(local!observaciones)*/
                    /*disabled:if(and( a!isNullOrEmpty(local!observaciones),rule!SCDO_ALGUN_PENDIENTE(ri!digitalizados)=false),true,false)*/
                    disabled: a!match(value:a!isNullOrEmpty(local!observaciones),
                    equals: true(),
                    then: true(),
                    whenTrue: #"_a-0000eb09-d442-8000-e687-01ef9001ef90_8857303"(local!digitalizado_pendientes),
                    then: true(),
                    default: false()
                    ),
                    
                    
                  
                    submit: false,
                    saveInto: {
                      local!rechazar,
                      #"SYSTEM_SYSRULES_startProcess"(
                        processModel: #"_a-0000e982-d80b-8000-e63b-01ef9001ef90_4780412",
                        processParameters: {
                          rechazado: local!rechazar,
                          reporte: ri!reporte,

                        },
                        onSuccess: {
                          a!save(ri!reporte.observaciones, local!observaciones),
                          a!save(ri!mostrarDocumentos, false),
                          a!save(ri!documentacion, null),
                          a!save(local!digitalizado_pendientes, null),
                          a!save(ri!refreshCount, ri!refreshCount + 1),
                          a!save(local!observaciones, null),
                          a!save(ri!mostrarGrid, true),
                          a!save(ri!reporte, null),

                        }
                      )
                    },
                    confirmHeader: "¿Desea Aceptar este reporte?",
                    confirmButtonLabel: "Sí, Aceptar",
                    cancelButtonLabel: "Cancelar",
                    icon: "check",
                    loadingIndicator: true
                  ),
                  #"SYSTEM_SYSRULES_ButtonWidget"(
                    label: "Rechazar",
                    style: "DESTRUCTIVE",
                    confirmMessage: "El reporte pasará a estar en el apartado de Contratos Pendientes",
                    /*disabled: a!isNullOrEmpty(local!observaciones)*/
                    disabled: if(

                      a!isNullOrEmpty(local!observaciones),
                      true,
                      if(#"_a-0000eb09-d442-8000-e687-01ef9001ef90_8857303"(local!digitalizado_pendientes)=true,
                      true,false)
                    ),
                    submit: true,
                    value: true,
                    saveInto: {
                      local!rechazar,
                      #"SYSTEM_SYSRULES_startProcess"(
                        processModel: #"_a-0000e982-d80b-8000-e63b-01ef9001ef90_4780412",
                        processParameters: {
                          rechazado: local!rechazar,
                          reporte: ri!reporte,
                          observaciones_texto: local!observaciones
                        },
                        onSuccess: {
                          a!save(ri!mostrarDocumentos, false),
                          a!save(ri!reporte, null),
                          a!save(ri!documentacion, null),
                          /*a!save(local!digitalizado_pendientes, null),*/
                          a!save(ri!refreshCount, ri!refreshCount + 1),
                          a!save(ri!mostrarGrid, true),
                          a!save(local!observaciones, null),
                          a!save(
                            local!digitalizado_pendientes,
                            #"_a-0000e9f5-96e6-8000-e641-01ef9001ef90_6495671"(
                              contrato: index(ri!reporte,"contrato", null),
                              operacion:index(ri!reporte,"operacion", null),
                              idReporte:index(ri!reporte,"idreporte", null)) 
                          )
                        }
                      )
                    },
                    confirmHeader: "¿Desea Rechazar este reporte?",
                    confirmButtonLabel: "Sí, Rechazar",
                    cancelButtonLabel: "Cancelar",
                    icon: "times",
                    loadingIndicator: true
                  )
                },
                align: "START"
              )
            )
          },
          showWhen: a!isNullOrEmpty(ri!soloDocumentos)
        )
      },
      {
        #"SYSTEM_SYSRULES_sectionLayout_v1"(
          contents: {
            #"SYSTEM_SYSRULES_columnsLayout"(
              columns: {
                #"SYSTEM_SYSRULES_columnLayout"(),
                #"SYSTEM_SYSRULES_columnLayout"(
                  contents: {
                    if(
                      and(
                        local!decisionSeleccionada = "Rechazar",
                        or(
                          local!documentacionSeleccionada.estado = "P",
                          local!digitalizadoSeleccionado.estado = "P"
                        )
                      ),
                      {
                        #"SYSTEM_SYSRULES_richTextDisplayField"(
                          value: {
                            #"SYSTEM_SYSRULES_richTextHeader"(
                              text: "¿Está seguro de que desea rechazar este documento?",
                              size: "MEDIUM"
                            )
                          },
                          align: "CENTER",
                          marginAbove: "MORE",
                          marginBelow: "MORE"
                        )
                      },
                      if(
                        and(
                          local!decisionSeleccionada = "Aceptar",
                          or(
                            local!documentacionSeleccionada.estado = "A",
                            local!digitalizadoSeleccionado.estado = "A"
                          )
                        ),
                        {
                          #"SYSTEM_SYSRULES_richTextDisplayField"(
                            value: {
                              #"SYSTEM_SYSRULES_richTextHeader"(
                                text: concat(
                                  "Este Documento ya ha sido aceptado anteriormente por el usuario: ",
                                  local!documentacionSeleccionada.usuarioacepto,
                                  " el día: ",
                                  local!documentacionSeleccionada.fechaacepto
                                ),
                                size: "MEDIUM"
                              )
                            },
                            align: "CENTER",
                            marginAbove: "MORE",
                            marginBelow: "MORE"
                          )
                        },
                        if(
                          and(
                            local!decisionSeleccionada = "Rechazar",
                            or(
                              local!documentacionSeleccionada.estado = "A",
                              local!digitalizadoSeleccionado.estado = "A"
                            )
                          ),
                          {
                            #"SYSTEM_SYSRULES_richTextDisplayField"(
                              value: {
                                #"SYSTEM_SYSRULES_richTextHeader"(
                                  text: concat(
                                    "Este Documento ya ha sido aceptado anteriormente por el usuario: ",
                                    local!documentacionSeleccionada.usuarioacepto,
                                    " el día: ",
                                    local!documentacionSeleccionada.fechaacepto,
                                    ". ¿Desea rechazar este documento?"
                                  ),
                                  size: "MEDIUM"
                                )
                              },
                              align: "CENTER",
                              marginAbove: "MORE",
                              marginBelow: "MORE"
                            )
                          },
                          {
                            #"SYSTEM_SYSRULES_richTextDisplayField"(
                              value: {
                                #"SYSTEM_SYSRULES_richTextHeader"(
                                  text: "¿Está seguro de que desea aceptar este documento?",
                                  size: "MEDIUM"
                                )
                              },
                              align: "CENTER",
                              marginAbove: "MORE",
                              marginBelow: "MORE"
                            )
                          }
                        )
                      )
                    ),
                    /*a!richTextDisplayField(*/
                      /*value: a!richTextItem(*/
                        /*text: "En caso de no estar seguro puede ver nuevamente el documento aquí ",*/
                        /*link: a!documentDownloadLink()*/
                      /*),*/
                      /*align: "CENTER"*/
                    /*),*/
                    if(
                      and(
                        local!decisionSeleccionada = "Rechazar",
                        or(
                          local!documentacionSeleccionada.estado = "P",
                          local!digitalizadoSeleccionado.estado = "P"
                        )
                      ),
                      {
                        #"SYSTEM_SYSRULES_ButtonLayout"(
                          primaryButtons: {
                            #"SYSTEM_SYSRULES_ButtonWidget"(
                              label: "Sí, Rechazar",
                              style: "DESTRUCTIVE",
                              submit: false,
                              value: true,
                              saveInto: {
                                local!decisionFinal,
                                if(
                                  a!isNotNullOrEmpty(local!documentacionSeleccionada),
                                  a!save(
                                    local!documentacionSeleccionada.estado,
                                    "R"
                                  ),
                                  a!save(
                                    local!digitalizadoSeleccionado.estado,
                                    "R"
                                  )
                                ),
                                #"SYSTEM_SYSRULES_startProcess"(
                                  processModel: #"_a-0000e982-d80b-8000-e63b-01ef9001ef90_4795736",
                                  processParameters: {
                                    cancel: false,
                                    decisionFinal: local!decisionFinal,
                                    decisionGrid2: local!decisionSeleccionada,
                                    documentacion: local!documentacionSeleccionada,
                                    digitalizado: local!digitalizadoSeleccionado
                                  },
                                  onSuccess: {
                                    if(
                                      a!isNullOrEmpty(fv!processInfo.pv.decisionFinal),
                                      {
                                        a!save(local!indicePagina, 1),
                                        a!save(local!decisionSeleccionada, null),
                                        a!save(local!documentacionSeleccionada, null),
                                        a!save(local!digitalizadoSeleccionado, null),
                                        a!save(local!indiceDocu, null)

                                      },
                                      if(
                                        and(
                                          toboolean(fv!processInfo.pv.decisionFinal) = true,
                                          local!decisionSeleccionada = "Rechazar",
                                          a!isNotNullOrEmpty(local!documentacionSeleccionada)
                                        ),
                                        {
                                          a!save(
                                            ri!documentacion,
                                            remove(ri!documentacion, local!indiceDocu)
                                          ),
                                          a!save(local!indicePagina, 1),
                                          a!save(local!decisionSeleccionada, null),
                                          a!save(local!documentacionSeleccionada, null),
                                          a!save(local!indiceDocu, null)

                                        },
                                        if(
                                          and(
                                            toboolean(fv!processInfo.pv.decisionFinal) = true,
                                            local!decisionSeleccionada = "Rechazar",
                                            a!isNotNullOrEmpty(local!digitalizadoSeleccionado)
                                          ),
                                          {
                                            /*a!save(ri!digitalizados, remove(ri!digitalizados, local!indiceDocu)),*/
                                            a!save(
                                             local!digitalizado_pendientes,
                                              #"_a-0000e9f5-96e6-8000-e641-01ef9001ef90_6495671"(
                                                contrato: ri!reporte.contrato,
                                                operacion: ri!reporte.operacion,
                                                idReporte: ri!reporte.idreporte
                                              )
                                            ),
                                            a!save(
                                             local!digitalizado_rechazado,
                                              #"_a-0000e982-d80b-8000-e63b-01ef9001ef90_4776405"(
                                                operacion: local!digitalizadoSeleccionado.operacion,
                                                contrato: local!digitalizadoSeleccionado.contrato,
                                                idReporte: index(ri!reporte,"idreporte", null)
                                              )
                                            ),
                                            a!save(local!indicePagina, 1),
                                            a!save(local!decisionSeleccionada, null),
                                            a!save(local!digitalizadoSeleccionado, null),
                                            a!save(local!indiceDocu, null)
                                          },
                                          {}
                                        )
                                      )
                                    )
                                  },
                                  onError: {
                                    a!save(local!indicePagina, 1),
                                    a!save(local!decisionSeleccionada, null),
                                    a!save(local!documentacionSeleccionada, null),
                                    a!save(local!digitalizadoSeleccionado, null)

                                  }
                                )
                              },
                              loadingIndicator: true
                            )
                          },
                          secondaryButtons: {
                            #"SYSTEM_SYSRULES_ButtonWidget"(
                              label: "Cancelar",
                              style: "SECONDARY",
                              submit: false,
                              validate: false,
                              value: true,
                              saveInto: {
                                ri!mostrarDocumentos,
                                a!save(local!indicePagina, 1),
                                a!save(local!decisionSeleccionada, null),
                                a!save(local!documentacionSeleccionada, null),
                                a!save(local!digitalizadoSeleccionado, null),
                                a!save(local!indiceDocu, null)

                              }
                            )
                          }
                        )
                      },
                      if(
                        and(
                          local!decisionSeleccionada = "Aceptar",
                          or(
                            local!documentacionSeleccionada.estado = "A",
                            local!digitalizadoSeleccionado = "A"
                          )
                        ),
                        {
                          #"SYSTEM_SYSRULES_ButtonLayout"(
                            primaryButtons: {
                              #"SYSTEM_SYSRULES_ButtonWidget"(
                                label: "Aceptar",
                                style: "PRIMARY",
                                submit: false,
                                value: true,
                                saveInto: {
                                  a!save(local!indicePagina, 1),
                                  a!save(local!decisionSeleccionada, null),
                                  a!save(local!documentacionSeleccionada, null)
                                },
                                icon: "check",
                                loadingIndicator: true
                              )
                            }
                          )
                        },
                        {
                          #"SYSTEM_SYSRULES_ButtonLayout"(
                            primaryButtons: {
                              #"SYSTEM_SYSRULES_ButtonWidget"(
                                label: "Sí, Aceptar",
                                style: "PRIMARY",
                                submit: false,
                                value: true,
                                saveInto: {
                                  local!decisionFinal,
                                  if(
                                    a!isNotNullOrEmpty(local!documentacionSeleccionada),
                                    a!save(
                                      local!documentacionSeleccionada.estado,
                                      "A"
                                    ),
                                    a!save(
                                      local!digitalizadoSeleccionado.estado,
                                      "A"
                                    )
                                  ),
                                  #"SYSTEM_SYSRULES_startProcess"(
                                    processModel: #"_a-0000e982-d80b-8000-e63b-01ef9001ef90_4795736",
                                    processParameters: {
                                      cancel: false,
                                      decisionFinal: local!decisionFinal,
                                      decisionGrid2: local!decisionSeleccionada,
                                      documentacion: local!documentacionSeleccionada,
                                      digitalizado: local!digitalizadoSeleccionado
                                    },
                                    onSuccess: {
                                      if(
                                        a!isNullOrEmpty(fv!processInfo.pv.decisionFinal),
                                        {
                                          a!save(local!indicePagina, 1),
                                          a!save(local!decisionSeleccionada, null),
                                          a!save(local!documentacionSeleccionada, null),
                                          a!save(local!indiceDocu, null)
                                        },
                                        if(
                                          and(
                                            toboolean(fv!processInfo.pv.decisionFinal) = true,
                                            local!decisionSeleccionada = "Aceptar",
                                            a!isNotNullOrEmpty(local!documentacionSeleccionada)
                                          ),
                                          {
                                            if(
                                              a!isNotNullOrEmpty(local!documentacionSeleccionada),
                                              {
                                                a!save(
                                                  ri!documentacion,
                                                  remove(ri!documentacion, local!indiceDocu)
                                                ),
                                                a!save(
                                                  ri!documentacion,
                                                  insert(
                                                    ri!documentacion,
                                                    local!documentacionSeleccionada,
                                                    local!indiceDocu
                                                  )
                                                ),
                                                a!save(local!indicePagina, 1),
                                                a!save(local!decisionSeleccionada, null),
                                                a!save(local!documentacionSeleccionada, null),
                                                a!save(local!indiceDocu, null)
                                              },
                                              {
                                                a!save(local!indicePagina, 1),
                                                a!save(local!decisionSeleccionada, null),
                                                a!save(local!documentacionSeleccionada, null),
                                                a!save(local!indiceDocu, null)
                                              }
                                            )
                                          },
                                          if(
                                            and(
                                              toboolean(fv!processInfo.pv.decisionFinal) = true,
                                              local!decisionSeleccionada = "Aceptar",
                                              a!isNotNullOrEmpty(local!digitalizadoSeleccionado)
                                            ),
                                            {
                                              a!save(
                                                local!digitalizado_pendientes,
                                                remove( local!digitalizado_pendientes, local!indiceDocu)
                                              ),
                                              a!save(
                                                local!digitalizado_pendientes,
                                                insert(
                                                  local!digitalizado_pendientes,
                                                  local!digitalizadoSeleccionado,
                                                  local!indiceDocu
                                                )
                                              ),
                                              a!save(local!indicePagina, 1),
                                              a!save(local!decisionSeleccionada, null),
                                              a!save(local!digitalizadoSeleccionado, null),
                                              a!save(local!indiceDocu, null)
                                            },
                                            {
                                              a!save(local!indicePagina, 1),
                                              a!save(local!decisionSeleccionada, null),
                                              a!save(local!digitalizadoSeleccionado, null),
                                              a!save(local!indiceDocu, null)
                                            }
                                          )
                                        )
                                      )
                                    },
                                    onError: {
                                      a!save(local!indicePagina, 1),
                                      a!save(local!decisionSeleccionada, null),
                                      a!save(local!documentacionSeleccionada, null),
                                      a!save(local!digitalizadoSeleccionado, null),
                                      a!save(local!indiceDocu, null),
                                      a!save(local!decisionFinal, null)
                                    }
                                  )
                                },
                                loadingIndicator: true
                              )
                            },
                            secondaryButtons: {
                              #"SYSTEM_SYSRULES_ButtonWidget"(
                                label: "Cancelar",
                                style: "SECONDARY",
                                submit: false,
                                validate: false,
                                value: true,
                                saveInto: {
                                  a!save(local!indicePagina, 1),
                                  a!save(local!decisionSeleccionada, null),
                                  a!save(local!documentacionSeleccionada, null),
                                  a!save(local!digitalizadoSeleccionado, null)
                                }
                              )
                            }
                          )
                        }
                      )
                    )
                  }
                ),
                #"SYSTEM_SYSRULES_columnLayout"()
              }
            )

          }
        )
      }
    )
  }
)</definition>
        <namedTypedValue>
            <name>mostrarDocumentos</name>
            <type>
                <name>boolean</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>documentacion</name>
            <type>
                <name>scdo_documentacion?list</name>
                <namespace>urn:com:appian:types</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>reporte</name>
            <type>
                <name>cdo_reportes</name>
                <namespace>urn:com:appian:types</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>soloDocumentos</name>
            <type>
                <name>boolean</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>reporteAprobado</name>
            <type>
                <name>cdo_reportes_aprobados</name>
                <namespace>urn:com:appian:types</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>refreshCount</name>
            <type>
                <name>int</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>mostrarGrid</name>
            <type>
                <name>boolean</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
        </namedTypedValue>
        <preferredEditor>interface</preferredEditor>
        <offlineEnabled>false</offlineEnabled>
        <isCustom>false</isCustom>
    </interface>
    <roleMap public="true">
        <role inherit="true" allowForAll="false" name="readers">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="authors">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="administrators">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyReaders">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAuthors">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAdministrators">
            <users/>
            <groups/>
        </role>
    </roleMap>
    <typedValue>
        <type>
            <name>RuleTestConfig?list</name>
            <namespace>http://www.appian.com/ae/types/2009</namespace>
        </type>
        <value>
            <el>
                <a:name/>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" xsi:type="xsd:boolean"/>
                    <a:nameRef>mostrarDocumentos</a:nameRef>
                    <a:id>1</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">null</a:value>
                    <a:nameRef>documentacion</a:nameRef>
                    <a:id>2</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">null</a:value>
                    <a:nameRef>reporte</a:nameRef>
                    <a:id>3</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">null()</a:value>
                    <a:nameRef>soloDocumentos</a:nameRef>
                    <a:id>4</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">null</a:value>
                    <a:nameRef>reporteAprobado</a:nameRef>
                    <a:id>5</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" xsi:type="xsd:int"/>
                    <a:nameRef>refreshCount</a:nameRef>
                    <a:id>6</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true" xsi:type="xsd:boolean"/>
                    <a:nameRef>mostrarGrid</a:nameRef>
                    <a:id>7</a:id>
                </a:ruleInputTestConfigs>
                <a:assertions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
            </el>
        </value>
    </typedValue>
    <history>
        <historyInfo versionUuid="_a-0000e8a9-7b47-8000-e5e7-01ef9001ef90_2275471"/>
        <historyInfo versionUuid="_a-0000ea2e-319c-8000-e644-01ef9001ef90_6849825"/>
        <historyInfo versionUuid="_a-0000ea52-e6d5-8000-e654-01ef9001ef90_7548118"/>
        <historyInfo versionUuid="_a-0000eabf-35e2-8000-e683-01ef9001ef90_8429709"/>
        <historyInfo versionUuid="_a-0000eb09-d442-8000-e687-01ef9001ef90_8861459"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9390666"/>
        <historyInfo versionUuid="_a-0000ec5b-dce3-8000-e69f-01ef9001ef90_10131399"/>
    </history>
</contentHaul>
