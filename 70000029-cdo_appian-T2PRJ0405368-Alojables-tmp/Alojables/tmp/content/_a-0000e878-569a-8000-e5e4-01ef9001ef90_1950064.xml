<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<contentHaul xmlns:a="http://www.appian.com/ae/types/2009">
    <versionUuid>_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9500175</versionUuid>
    <interface>
        <name>SCDO_Documento_Buzon</name>
        <uuid>_a-0000e878-569a-8000-e5e4-01ef9001ef90_1950064</uuid>
        <description>Interface correspondiente al modulo Operaciones</description>
        <parentUuid>_a-0000e801-560f-8000-e5d9-01ef9001ef90_1707049</parentUuid>
        <visibility>
            <advertise>false</advertise>
            <hierarchy>true</hierarchy>
            <indexable>true</indexable>
            <quota>false</quota>
            <searchable>true</searchable>
            <system>false</system>
            <unlogged>false</unlogged>
        </visibility>
        <definition>a!localVariables(
  local!showInformationBanner_eliminar: true,
  /*------*/

  /*correcto_eliminar*/
  local!flag_eliminar: now(),
  local!showWhen_eliminar: a!refreshVariable(
    value: now() &lt; local!flag_eliminar,
    refreshInterval: 0.5
  ),
  /*-----*/

  /*error_elimianr*/
  local!flag_error_eliminar: now(),
  local!showWhen_error_eliminar: a!refreshVariable(
    value: now() &lt; local!flag_error_eliminar,
    /* especifique el intervalo después de cuántos minutos desea finalizar el examen */
    refreshInterval: 0.5
  ),
  /*------*/
  local!refreshCount:0,
  local!infogrid2,
  local!infogrid2_aprobados,
  local!infogrid2_eliminados,
  local!mostrarGrid: true,
  local!paginacion: #"_a-0000e982-d80b-8000-e63b-01ef9001ef90_4766196"[1],
  local!bUserT,
  local!bUser,
  local!criteria,
  local!startIndex: 1,
  local!batchSize: 10,
  local!idsDocumentosBuscar,
  local!imagenes_pendientes_cdt: 
  a!refreshVariable(
    
 value: 
 #"SYSTEM_SYSRULES_queryEntity_v2"(
   entity: #"_a-0000e982-d80b-8000-e63b-01ef9001ef90_4679248",
   query: #"SYSTEM_SYSRULES_query"(
     logicalExpression: 
     #"SYSTEM_SYSRULES_queryLogicalExpression"(
       operator: "AND",
       logicalExpressions: {
         #"SYSTEM_SYSRULES_queryLogicalExpression"(
           operator: "AND",
           filters: {
             #"SYSTEM_SYSRULES_queryFilter"(field: "tipo", operator: "=", value: "DOC"),

           }
         ),
         #"SYSTEM_SYSRULES_queryLogicalExpression"(
           operator: "OR",
           filters: {
             #"SYSTEM_SYSRULES_queryFilter"(

               field: "idimagen",
               operator: "not null",
               /*value: local!criteria,*/
               applyWhen: a!isNullOrEmpty(local!criteria)
             ),
             #"SYSTEM_SYSRULES_queryFilter"(

               field: "contrato",
               operator: "includes",
               value: local!criteria,
               applyWhen: a!isNotNullOrEmpty(local!criteria)
             ),
             #"SYSTEM_SYSRULES_queryFilter"(
               field: "deal",
               operator: "includes",
               value: local!criteria,
               applyWhen: a!isNotNullOrEmpty(local!criteria)
             ),
             #"SYSTEM_SYSRULES_queryFilter"(
               field: "fechacaptura",
               operator: "includes",
               value: local!criteria,
               applyWhen: a!isNotNullOrEmpty(local!criteria)
             ),
             #"SYSTEM_SYSRULES_queryFilter"(
               field: "usuario",
               operator: "includes",
               value: local!criteria,
               applyWhen: a!isNotNullOrEmpty(local!criteria)
             ),
             #"SYSTEM_SYSRULES_queryFilter"(
               field: "ip",
               operator: "includes",
               value: local!criteria,
               applyWhen: a!isNotNullOrEmpty(local!criteria)
             ),
             #"SYSTEM_SYSRULES_queryFilter"(
               field: "iddocumento",
               operator: "in",
               value: local!idsDocumentosBuscar,
               applywhen: a!isNotNullOrEmpty(local!idsDocumentosBuscar)
             ),

           },
           /*ignoreFiltersWithEmptyValues: true*/
         ),

       }
     )
     ,
     pagingInfo: #"SYSTEM_SYSRULES_pagingInfo"(
       startIndex: local!startIndex,
       batchSize: local!batchSize
     )
   ),
   fetchTotalCount: true
 ),
 

  refreshOnVarChange: local!refreshCount
  ),
  local!documento: #"_a-0000e982-d80b-8000-e63b-01ef9001ef90_4689904"(paginInfo: #"SYSTEM_SYSRULES_pagingInfo"(1, - 1)),
 
  local!iddocumento,
  local!idimagen,
  local!docRepetido: false,
  local!documentooo: a!refreshVariable(
    value: index(
      #"_a-0000e982-d80b-8000-e63b-01ef9001ef90_4679364"(
        idimagen: local!idimagen,
        iddocumento: local!iddocumento
      ),
      "iddocumento",
      null
    ),
    refreshAlways: true
  ),
  {
    #"SYSTEM_SYSRULES_columnsLayout"(
      columns: {
       
        /*CORRECTO ELIMINAR*/
        #"SYSTEM_SYSRULES_columnLayout"(
          contents: {
            #"_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9394093"(
              showInformationBanner: local!showInformationBanner_eliminar
            )
          },
          showWhen: and(
            local!showInformationBanner_eliminar,
            local!showWhen_eliminar
          )
        ),
        /*ERROR ELIMINAR*/
        #"SYSTEM_SYSRULES_columnLayout"(
          contents: {
            #"_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9394317"(
              showInformationBanner: local!showInformationBanner_eliminar
            )
          },
          showWhen: and(
            local!showInformationBanner_eliminar,
            local!showWhen_error_eliminar
          )
        ),
      }
    ),
    #"SYSTEM_SYSRULES_columnsLayout"(
      columns: {
        #"SYSTEM_SYSRULES_columnLayout"(
          contents: {
            #"SYSTEM_SYSRULES_textField"(
              label: "Buscar:",
              labelPosition: "ADJACENT",
              instructions: "Introduce cualquier criterio para buscar",
              value: local!bUserT,
              saveInto: local!bUserT,
              /*value: local!criteria,*/
              /*saveInto: local!criteria,*/
              refreshAfter: "KEYPRESS",
              validations: {}
            )
          }
        ),
        #"SYSTEM_SYSRULES_columnLayout"(
          contents: {
            #"SYSTEM_SYSRULES_ButtonArrayLayout"(
              buttons: {
                #"SYSTEM_SYSRULES_ButtonWidget"(
                  label: "Buscar",
                  loadingIndicator: true,
                  size: "SMALL",
                  icon: "search",
                  saveInto: {
                    a!save(local!startIndex, 1),
                    a!save(local!criteria,local!bUserT),
                    a!save(
                      local!idsDocumentosBuscar,
                      if(
                        a!isNullOrEmpty(local!criteria),
                        null,
                        if(
                          a!isNullOrEmpty(
                            #"_a-0000e968-30a1-8000-e639-01ef9001ef90_4493570"(documento: local!criteria)
                          ),
                          null,
                          a!flatten(
                            #"_a-0000e968-30a1-8000-e639-01ef9001ef90_4493570"(documento: local!criteria).iddocumento
                          )
                        )
                      )
                    ),
                   
                    a!save(local!refreshCount,local!refreshCount+1),
                    

                  },
                  style: "DESTRUCTIVE"
                )
              },
              align: "START",
              marginAbove: "NONE"
            )
          }
        ),

      },
      showWhen: local!mostrarGrid
    ),
    #"SYSTEM_SYSRULES_gridLayout"(
      label: "",
      labelPosition: "ABOVE",
      headerCells: {
        #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(label: "Contrato"),
        #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(label: "Operacion"),
        #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(label: "F.Captura"),
        #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(label: "Documento"),
        #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(label: "Usuario"),
        #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(label: "IP"),
        #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(label: "Archivo"),
        #"SYSTEM_SYSRULES_gridLayoutHeaderCell"(label: "ACCIONES")
      },
      columnConfigs: {},
      rows: {
        {
          #"SYSTEM_SYSRULES_forEach"(
            items: local!imagenes_pendientes_cdt.data,
            expression: #"SYSTEM_SYSRULES_gridRowLayout"(
              contents: {
                #"SYSTEM_SYSRULES_textField"(
                  value: fv!item.contrato,
                  readOnly: true,
                  align: "CENTER"
                ),
                #"SYSTEM_SYSRULES_textField"(
                  value: fv!item.deal,
                  readOnly: true,
                  align: "CENTER"
                ),
                #"SYSTEM_SYSRULES_textField"(
                  value: fv!item.fechacaptura,
                  readOnly: true,
                  align: "CENTER"
                ),
                #"SYSTEM_SYSRULES_textField"(
                  value: index(
                    index(
                      local!documento,
                      wherecontains(
                        trim(fv!item.iddocumento),
                        touniformstring(local!documento.iddocumento)
                      )
                    ),
                    "documento",
                    fv!item.documento
                  ),
                  saveInto: {
                    fv!item.iddocumento,
                    if(
                      and(
                        #"_a-0000e867-3fd5-8000-e5e3-01ef9001ef90_1882382"(index(fv!item, "iddocumento", null)),
                        contains(
                          touniformstring(local!documentooo),
                          tostring(index(fv!item, "iddocumento", null))
                        )
                      ),
                      a!save(local!docRepetido, true),
                      a!save(local!docRepetido, false)
                    )
                  },
                  readOnly: true
                ),
                #"SYSTEM_SYSRULES_textField"(
                  value: fv!item.usuario,
                  readOnly: true,
                  align: "CENTER"
                ),
                #"SYSTEM_SYSRULES_textField"(
                  value: fv!item.ip,
                  readOnly: true,
                  align: "CENTER"
                ),
                
                a!localVariables(
                  local!documento_descargar,
                  local!busque: false,
                  #"SYSTEM_SYSRULES_richTextDisplayField"(
                    labelPosition: "COLLAPSED",
                    value: {
                      #"SYSTEM_SYSRULES_richTextIcon"(
                        icon: "file-signature",
                        link: {
                          #"SYSTEM_SYSRULES_dynamicLink"(
                            saveInto: {
                              #"SYSTEM_SYSRULES_startProcess"(
                                processModel: #"_a-0000eabf-35e2-8000-e683-01ef9001ef90_8425441",
                                processParameters: { nombre_doc: fv!item.nombreimagenobs },
                                onSuccess: {
                                  a!save(
                                    local!documento_descargar,
                                    fv!processInfo.pv.documento
                                  ),
                                  a!save(local!busque, true),

                                }
                              ),

                            }
                          ),

                        },
                        linkStyle: "STANDALONE"
                      ),
                      if(
                        local!busque = false,
                        "",
                        if(
                          and(
                            local!busque,
                            a!isNotNullOrEmpty(local!documento_descargar)
                          ),
                          #"SYSTEM_SYSRULES_richTextIcon"(
                            caption: "Descargar documento.",
                            icon: "download",
                            link: {
                              #"SYSTEM_SYSRULES_documentDownloadLink"(document: local!documento_descargar),

                            },
                            linkStyle: "STANDALONE"
                          ),
                          #"SYSTEM_SYSRULES_richTextIcon"(
                            caption: "Ha ocurrido un error al obtener el documento.",
                            icon: "exclamation",
                            linkStyle: "STANDALONE"
                          )
                        )
                      )
                    }
                  ),

                ),
                #"SYSTEM_SYSRULES_ButtonArrayLayout"(
                  buttons: {
                    #"SYSTEM_SYSRULES_ButtonWidget"(
                      icon: "trash-o",
                      tooltip: "Eliminar Documento",
                      loadingIndicator: true,
                      value: fv!index,
                      saveInto: {
                        a!save(ri!datoSeleccionado, fv!item),
                       
                        #"SYSTEM_SYSRULES_startProcess"(
                          processModel: #"_a-0000eabf-35e2-8000-e683-01ef9001ef90_8477251",
                          processParameters: { id_imagen: fv!item.idimagen },
                          onSuccess: {
                            
                            a!save(local!showInformationBanner_eliminar, true),
                            if(
                              toboolean(fv!processInfo.pv.error) = false,
                              {a!save(local!flag_eliminar, addseconds(now(), 10)),
                             
                              a!save(
                                ri!proceso_txt,
                                "Se eliminó registro con éxito"
                              ),
                              a!save({ ri!datoSeleccionado }, null),
                              a!save(local!refreshCount,local!refreshCount+1),

                              },
                              {a!save(local!flag_error_eliminar, addseconds(now(), 10)),
                              a!save(
                                ri!proceso_txt,
                                "El registro no pudo ser eliminado"
                              )
                              }
                            ),
                           
                            
                          },
                         
                        ),
                        a!save(ri!datoSeleccionado, null),

                      },
                      style: "DESTRUCTIVE",
                      confirmHeader: "Se eliminará el documento ",
                      confirmMessage: "¿Continuar?"
                    ),
                    #"SYSTEM_SYSRULES_ButtonWidget"(
                      icon: "eye",
                      tooltip: "Detalles de operacion",
                      loadingIndicator: true,
                      value: fv!index,
                      saveInto: {
                        a!save(local!mostrarGrid, false),
                        a!save(
                          local!infogrid2,
                          
                          #"_a-0000e8d8-9b98-8000-e605-01ef9001ef90_2933354"(operacion: fv!item.deal)
                        ),
                        a!save(
                          local!infogrid2_aprobados,

                          #"_a-0000e8d8-9b98-8000-e605-01ef9001ef90_2873730"(operacion: fv!item.deal)
                        ),
                        a!save(
                          local!infogrid2_eliminados,

                          #"_a-0000e8d8-9b98-8000-e605-01ef9001ef90_2952237"(operacion: fv!item.deal)
                        )
                      },
                      style: "DESTRUCTIVE"
                    )
                  },
                  align: "CENTER"
                )
              }
            )
          )
        }
      },
      selectionSaveInto: {},
      showWhen: local!mostrarGrid,
      validations: {},
      shadeAlternateRows: true
    ),
    if(
      local!mostrarGrid = false,
      
      #"_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9171289"(
        mostrarGrid: local!mostrarGrid,
        reporte: if(
          a!isNullOrEmpty(local!infogrid2),
          null,
          local!infogrid2[1]
        ),
        reporte_aprobado: if(
          a!isNullOrEmpty(local!infogrid2_aprobados),
          null,
          local!infogrid2_aprobados[1]
        ),
        reporte_eliminado: if(
          a!isNullOrEmpty(local!infogrid2_eliminados),
          null,
          local!infogrid2_eliminados[1]
        ),
        
      ),
      {}
    ),
    #"SYSTEM_SYSRULES_richTextDisplayField"(
      labelPosition: "COLLAPSED",
      value: {
        #"SYSTEM_SYSRULES_richTextIcon"(
          icon: "angle-double-left",
          link: #"SYSTEM_SYSRULES_dynamicLink"(
            saveInto: {
              a!save(local!startIndex, 1),

            },
            showWhen: not(local!startIndex = 1)
          ),
          linkStyle: "STANDALONE",
          size: "MEDIUM_PLUS"
        ),
        #"SYSTEM_SYSRULES_richTextIcon"(
          icon: "angle-left",
          link: #"SYSTEM_SYSRULES_dynamicLink"(
            saveInto: {
              a!save(
                local!startIndex,
                tointeger(local!startIndex - 10)
              ),
              
            },
            showWhen: not(local!startIndex = 1)
          ),
          linkStyle: "STANDALONE",
          size: "MEDIUM_PLUS"
        ),
        #"SYSTEM_SYSRULES_richTextItem_v1"(
          text: {
            #"SYSTEM_SYSRULES_richTextItem_v1"(
              text: {
                local!startIndex &amp; " - " &amp; if(
                  local!startIndex &gt; tointeger(
                    local!imagenes_pendientes_cdt.totalCount + 10
                  ),
                  local!imagenes_pendientes_cdt.totalCount,
                  if(
                    local!startIndex &gt;= local!imagenes_pendientes_cdt.totalCount,
                    local!imagenes_pendientes_cdt.totalCount,
                    local!startIndex + 9
                  )
                )
              },
              style: { "STRONG" }
            ),
            " de " &amp; local!imagenes_pendientes_cdt.totalCount
          },
          size: "STANDARD"
        ),
        #"SYSTEM_SYSRULES_richTextIcon"(
          icon: "angle-right",
          link: #"SYSTEM_SYSRULES_dynamicLink"(
            saveInto: {
              a!save(
                local!startIndex,
                tointeger(local!startIndex + 10)
              ),
              
            },
            showWhen: 
              local!startIndex+9 &lt; local!imagenes_pendientes_cdt.totalCount
            
          ),
          linkStyle: "STANDALONE",
          size: "MEDIUM_PLUS"
        ),
        #"SYSTEM_SYSRULES_richTextIcon"(
          icon: "angle-double-right",
          link: #"SYSTEM_SYSRULES_dynamicLink"(
            saveInto: {
              a!save(
                local!startIndex,
                tointeger(
                  local!imagenes_pendientes_cdt.totalCount - tointeger(
                    right(
                      local!imagenes_pendientes_cdt.totalCount
                    )
                  ) + 1
                )
              ),
             
            },
            showWhen:
              local!startIndex+9 &lt; local!imagenes_pendientes_cdt.totalCount
            
          ),
          linkStyle: "STANDALONE",
          size: "MEDIUM_PLUS"
        )
      },
      align: "RIGHT",
      showWhen: local!mostrarGrid
    )
  }

)</definition>
        <namedTypedValue>
            <name>datoSeleccionado</name>
            <type>
                <name>DataSubset</name>
                <namespace>http://www.appian.com/ae/types/2009</namespace>
            </type>
        </namedTypedValue>
        <namedTypedValue>
            <name>proceso_txt</name>
            <type>
                <name>string</name>
                <namespace>http://www.w3.org/2001/XMLSchema</namespace>
            </type>
            <value/>
        </namedTypedValue>
        <preferredEditor>interface</preferredEditor>
        <offlineEnabled>false</offlineEnabled>
        <isCustom>false</isCustom>
    </interface>
    <roleMap public="true">
        <role inherit="true" allowForAll="false" name="readers">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="authors">
            <users/>
            <groups/>
        </role>
        <role inherit="true" allowForAll="false" name="administrators">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyReaders">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAuthors">
            <users/>
            <groups/>
        </role>
        <role inherit="false" allowForAll="false" name="denyAdministrators">
            <users/>
            <groups/>
        </role>
    </roleMap>
    <typedValue>
        <type>
            <name>RuleTestConfig?list</name>
            <namespace>http://www.appian.com/ae/types/2009</namespace>
        </type>
        <value>
            <el>
                <a:name/>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="a:Expression">'type!{urn:com:appian:types}cdo_catalogo_documentos'(
),</a:value>
                    <a:nameRef>datoSeleccionado</a:nameRef>
                    <a:id>1</a:id>
                </a:ruleInputTestConfigs>
                <a:ruleInputTestConfigs>
                    <a:value xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="xsd:string"/>
                    <a:nameRef>proceso_txt</a:nameRef>
                    <a:id>2</a:id>
                </a:ruleInputTestConfigs>
                <a:assertions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>
            </el>
        </value>
    </typedValue>
    <history>
        <historyInfo versionUuid="_a-0000e8b2-d897-8000-e5f1-01ef9001ef90_2379460"/>
        <historyInfo versionUuid="_a-0000ea22-4ef8-8000-e643-01ef9001ef90_6729937"/>
        <historyInfo versionUuid="_a-0000eabf-35e2-8000-e683-01ef9001ef90_8477415"/>
        <historyInfo versionUuid="_a-0000eb09-d442-8000-e687-01ef9001ef90_8814515"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9171925"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9395264"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9450210"/>
        <historyInfo versionUuid="_a-0000eb53-0a0e-8000-e689-01ef9001ef90_9500175"/>
    </history>
</contentHaul>
